<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="keywords" content="swift python objective-c">
<meta property="og:type" content="website">
<meta property="og:title" content="MrBoog Zone">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="MrBoog Zone">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MrBoog Zone">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>MrBoog Zone</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-133159358-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MrBoog Zone</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Welcome bro!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/17/2017-03-17-scripting-swift/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/17/2017-03-17-scripting-swift/" itemprop="url">Scripting Swift</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-17T17:19:06+08:00">
                2017-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/17/2017-03-17-scripting-swift/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/03/17/2017-03-17-scripting-swift/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>作为iOS开发者，Swift断断续续也用了几年了，不得不说还真是很好用的。但其实swift不仅可以用来写 iOS or Mac OS，只要装了Xcode，<strong>Swift 在Mac系统下写起脚本来一样很好用的。</strong></p>
<p>Well… Long story short,  Let’s Get Started~~</p>
<h3 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello world"></a>Hello world</h3><p>首先，最简单的，我们先来在终端用swift输出hello world试试。<br>输入 <strong>swift</strong> into the terminal然后回车，输入任何swift语句比如打印hello world，使用<strong>Ctrl-D</strong>退出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ swift</span><br><span class="line">Welcome to Apple Swift. Type :help for assistance.</span><br><span class="line">1&gt; print(“Hello World”)</span><br><span class="line">2&gt;</span><br></pre></td></tr></table></figure>
<p>这就像Python一样，swift命令行的交互模式叫做 <a href="https://developer.apple.com/swift/blog/?id=18" target="_blank" rel="noopener"><strong>Swift REPL (read eval print loop)</strong></a>。<br>既然是按照脚本执行，肯定就存在这对应的解析执行脚本的程序。先看看我们平时用的bash：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/shells</span><br><span class="line"># List of acceptable shells for chpass(1).</span><br><span class="line"># Ftpd will not allow users to connect who are not using</span><br><span class="line"># one of these shells.</span><br><span class="line"></span><br><span class="line">/bin/bash</span><br><span class="line">/bin/csh</span><br><span class="line">/bin/ksh</span><br><span class="line">/bin/sh</span><br><span class="line">/bin/tcsh</span><br><span class="line">/bin/zsh</span><br></pre></td></tr></table></figure>
<p>这里当然没有了，不过如果我们执行type命令可以看到如下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ type swift</span><br><span class="line">swift is hashed (/usr/bin/swift)</span><br></pre></td></tr></table></figure>
<p>注意到<strong>/usr/bin/swift</strong>了吗，事实上这就是我们要找的了。</p>
<p>在swift脚本文件最上面加上<strong>#!/usr/bin/swift</strong> (或者 <em>#!/usr/bin/env swift</em>) 就启动swift解释器了, 后面的语句就会在swift环境下面编译。无需多说，这基本和我们以前使用bash时 要加入 <strong>#!/bin/bash</strong>一样。</p>
<p>接下来我们就创建一个demo.swift，做个最简单的测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$touch demo.swift</span><br><span class="line">$vim demo.swift</span><br></pre></td></tr></table></figure>
<p>编辑demo.swift文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/swift</span><br><span class="line"></span><br><span class="line">import Foundation </span><br><span class="line">print(&quot;hello world&quot;)</span><br></pre></td></tr></table></figure>
<p>编辑保存后，给它可执行的权限后，<strong>./demo.swift</strong>运行肯定就看到输出效果了。这样就是最简单的swift_脚本了_：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$chmod +x demo.swift</span><br><span class="line">$./demo.swift</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>
<h3 id="Demo-time"><a href="#Demo-time" class="headerlink" title="Demo time:"></a>Demo time:</h3><p>下面简单写一个可以传参数的demo，假设我们要做一个可以一键备份我的博客的功能。其实就是把文章Push到对应的Git服务器。</p>
<p>按照之前的步骤，创建一个新的 backup.swift文件，用来提交我的博客到git服务器，同时需要添加本次提交相应的描述。这样的话，这里我们要解决两个问题。</p>
<ol>
<li>既然提交的描述是动态的，需要通过参数传入。我们就能获取到命令行传入的参数。</li>
<li>需要在swift里面调用其他命令行工具，比如语句: git pull。</li>
</ol>
<p>要解决第一个问题，我们需要引用一个新的类<strong>CommandLine</strong> (或者更基础的<code>C_ARGC</code> and <code>C_ARGV</code>也可以)。<br>CommandLine.arguments是个数组，可以直接通过它拿到想要的参数。<br>至于第二个问题，我们需要引入另一个在Swift脚本中很重要类 <strong>Process</strong>。Process很强大，可以混合 swift和bash。这让我们在swift中使用git命令成为可能。</p>
<p>下面就是编写后的backup.swift文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/swift</span><br><span class="line"></span><br><span class="line">import Foundation</span><br><span class="line"></span><br><span class="line">func backup() &#123;</span><br><span class="line">    let args = CommandLine.arguments</span><br><span class="line">    guard args.count &gt; 1 else &#123;</span><br><span class="line">        return print(&quot;Backup Failed! : \n    Detail: Missing commit message whick should be surrounded by quotation mark.&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    let arg = args[1]</span><br><span class="line">    shell(&quot;git&quot;, &quot;pull&quot;)</span><br><span class="line">    shell(&quot;git&quot;, &quot;commit&quot;, &quot;-am&quot;, arg)</span><br><span class="line">    shell(&quot;git&quot;, &quot;push&quot;, &quot;origin&quot;, &quot;HEAD:source&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@discardableResult</span><br><span class="line">func shell(_ args: String...) -&gt; Int32 &#123;</span><br><span class="line">    let task = Process()</span><br><span class="line">    task.launchPath = &quot;/usr/bin/env&quot;</span><br><span class="line">    task.arguments = args</span><br><span class="line">    task.launch()</span><br><span class="line">    task.waitUntilExit()</span><br><span class="line">    return task.terminationStatus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backup()</span><br></pre></td></tr></table></figure>
<p>这个例子中，函数 <code>shell(_ args: String...) -&gt; Int32</code> 用来实现Swift调用其他命令行命令。<code>backup()</code> 会先读取输入的参数，然后执行对应的备份操作。<br>把这个脚本放在我的博客git目录下，运行就会自动开始将内容Push到git服务器了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./backup.swift &quot;Blog: Backup&quot;</span><br><span class="line">remote: Enumerating objects: 139, done.</span><br><span class="line">remote: Counting objects: 100% (139/139), done.</span><br><span class="line">remote: Compressing objects: 100% (33/33), done.</span><br><span class="line">remote: Total 149 (delta 53), reused 139 (delta 53), pack-reused 10</span><br><span class="line">Receiving objects: 100% (149/149), 61.23 KiB | 61.00 KiB/s, done.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/11/2017-02-11-apns-token-based-connection/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/11/2017-02-11-apns-token-based-connection/" itemprop="url">APNs Token-Based Connection</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-11T20:17:59+08:00">
                2017-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/11/2017-02-11-apns-token-based-connection/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/02/11/2017-02-11-apns-token-based-connection/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2016年苹果上线了新的推送验证方式，使用新的方式我们将不再需要之前的 <strong>.p12</strong>或者<strong>.pem</strong>文件，取而代之的是一个<strong>.p8</strong>文件 (并且不用区分dev和release环境)。一些大的推送服务厂商已经开始支持这种新的方式了，比如国外的<a href="https://firebase.google.com/docs/cloud-messaging/ios/certs" target="_blank" rel="noopener">Firebase</a>。这种新的方式优势还是很明显的，比如说</p>
<ul>
<li>速度更快 </li>
<li>可以支持同一开发者账号下的多个App </li>
<li>支持多个后台同时使用同一个文件 </li>
<li>不需要考虑生产和开发环境</li>
<li>不会过期</li>
</ul>
<p>需要注意的是，虽然新的推送验证永远不会过期，但认证密钥和<strong>.p8</strong>文件需要严格保密。如果发现有泄露风险，建议赶紧revoke然后重新创建。</p>
<p>由于不再需要分别配置dev和release环境的证书，所以测试的流程也会简化。<strong>推荐一个开源的基于Node.js的<a href="https://www.npmjs.com/package/apn" target="_blank" rel="noopener">推送后台</a>。</strong> 我是只用于测试的，毕竟真正的生产环境大家都还是在用一些大厂的服务，比如谷歌的Firebase或者国内的友盟推送等。这里有个简单用这个Node.js的<a href="https://github.com/MrBoog/Test-ANPS-with-p8-file" target="_blank" rel="noopener">Demo</a>, 可以用于开发者自己测试推送使用。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/10/2017-01-10-symbolicating-crash-log/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/10/2017-01-10-symbolicating-crash-log/" itemprop="url">Symbolicating crash log</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-10T17:23:39+08:00">
                2017-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/10/2017-01-10-symbolicating-crash-log/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/01/10/2017-01-10-symbolicating-crash-log/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>When our App crashes, a crash report is created and stored on the device. But usually, we need to symbolicate the log before analyzing it. So here I write down the steps to symbolicate crash log.</p>
<ol>
<li><p>Create a new folder. Place our crash file and dSYM file in that folder: </p>
<ul>
<li>myApp.crash</li>
<li>myApp.dSYM</li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>Find <code>symbolicatecrash</code> file in your Xcode (which is written by perl). Copy it to the folder that you just created.</p>
<p>Usually, the path should be:<br>​    <strong>/Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash</strong></p>
<p>Or, You could find the path by yourself:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /Applications/Xcode.app -name symbolicatecrash -type f</span><br></pre></td></tr></table></figure>
</li>
<li><p>export env var</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export DEVELOPER_DIR=&quot;/Applications/Xcode.app/Contents/Developer&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Final step, symbolicate crash </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./symbolicatecrash myApp.crash &gt; SymbolicatedM.crash</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Ok alright, we’ve already done all of the work. So if the dSYM is matched with the crash file, here should be possible to generate a new file: <strong>SymbolicatedM.crash</strong>. Just open it, after symbolicating it should be easy to read this time.</p>
<hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/22/2016-06-22-class-cluster/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/22/2016-06-22-class-cluster/" itemprop="url">Class cluster</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-06-22T20:29:41+08:00">
                2016-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/22/2016-06-22-class-cluster/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/22/2016-06-22-class-cluster/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Class cluster，类簇，这是苹果对抽象工厂模式一种应用，在苹果的Framework中使用广泛，是定义了相同的接口，并提供相同功能的一组类的集合。类簇会有一个公共抽象超类，比如NSString,NSArray,NSNumber,NSDictionary等等，来完成实例化一个具体的私有子类。对于使用者来说，只需要知道有公共超类各种API的作用就可以，不需要知道，超类背后子类的实际实现。</p>
<h5 id="self-super-init"><a href="#self-super-init" class="headerlink" title="self = [super init]"></a>self = [super init]</h5><p>我们在初始化的时候，为什么super init调用过后，会赋值给self呢？因为系统有很多时候使用了类簇，所以这样做防止产生的私有类和self不匹配。<code>实例的isa指针终究应该指向这个私有类，而不是当前的超类。</code><br>这样在发送消息的时候，self才能找到真正的需要执行的私有类的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id objc_msgSend(id self, SEL op, ...)</span><br></pre></td></tr></table></figure>
<h5 id="superclass"><a href="#superclass" class="headerlink" title="superclass"></a>superclass</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSArray *array = @[];</span><br><span class="line">NSLog(@&quot;%@&quot;,array.superclass);               //NSArray</span><br><span class="line">NSLog(@&quot;%@&quot;,NSStringFromClass(array.class)); //__NSArrayI</span><br></pre></td></tr></table></figure>
<p>对于类簇中的超类，比如NSArray，调用superclass就会发现，他的superclass才是真正的NSArray。</p>
<h5 id="isMemberOfClass"><a href="#isMemberOfClass" class="headerlink" title="isMemberOfClass"></a>isMemberOfClass</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSLog(@&quot;%d&quot;,[array isMemberOfClass:[NSArray class]]); //0</span><br><span class="line">NSLog(@&quot;%d&quot;,[array isKindOfClass:[NSArray class]]);   //1</span><br></pre></td></tr></table></figure>
<p>通过上面的输出同样证明了苹果的类簇利用了多态，通过子类化公共类来实现。<br>私有子类的实现，隐藏在簇的内部，不能被直接调用。这样公共类在使用中，实际上存放在内存中的是隐藏在类簇中的某个私有实例。<br>这样的好处很明显，针对类簇，调用者只需要简单的使用超类提供的API即可。这样NSNumber根据数据不同的类型，而有多种不同的子类化的NSNumber，NSArray根据存储策略不同也有不同的NSArray，而调用者却可以根本不用注意这些。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/20/2016-04-20-gem-source-geng-huan/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/20/2016-04-20-gem-source-geng-huan/" itemprop="url">Change gem source</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-20T11:43:30+08:00">
                2016-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/20/2016-04-20-gem-source-geng-huan/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/20/2016-04-20-gem-source-geng-huan/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>换电脑重新装pods的时候报错，其实是gem报错了。</p>
<p>在执行 <code>gem install cocoapods</code> 的时候，遇到了下面的错误，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unable to download data from https://ruby.taobao.org/ - SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed (https://rubygems-china.oss-cn-hangzhou.aliyuncs.com/latest_specs.4.8.gz)</span><br></pre></td></tr></table></figure>
<p>感觉像是阿里提供的源出了问题，目前手上没有vpn，只能在github上向原作者提了一个<a href="https://github.com/alibaba/ruby.taobao.org/issues/48" target="_blank" rel="noopener">issue</a>。作者很快给了反馈，原来是他们不再维护了。不过根据作者提供的<a href="https://ruby-china.org/topics/29250" target="_blank" rel="noopener">链接</a>，我们换一下其他的源就可以了~ 也感叹一下国内的网络环境😂</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gem sources --remove https://ruby.taobao.org/</span><br><span class="line"></span><br><span class="line">gem sources --add https://gems.ruby-china.org/</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/14/2016-03-14-multicast-delegate-in-oc/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/14/2016-03-14-multicast-delegate-in-oc/" itemprop="url">Objective-c Multicast Delegate</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-14T20:52:33+08:00">
                2016-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/03/14/2016-03-14-multicast-delegate-in-oc/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/03/14/2016-03-14-multicast-delegate-in-oc/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>NSNotificationCenter 我们肯定都有使用过，通过发送广播，实现一对多的消息发送。NSNotificationCenter使用起来灵活性特别高，但有时候过度使用反而是NSNotificationCenter 的弊端。在项目的设计中，我们也常会思考的一个问题：<strong>限制部分灵活性，以此来交换应用的可读性和可维护性。</strong></p>
<p>NSNotificationCenter 允许应用各种跨层访问，监听者要配合合理使用add、remove等方法，出了问题实在不好跟踪。在某些时刻，需要酌情考虑是否应该使用。</p>
<p>对于一对多的消息发送，其实还有很多办法可以考虑。比如说，我们可以通过<strong>NSProxy 实现消息转发</strong>，将我们普通一对一的delegate模式，改为一对多。</p>
<p>在目前实现过程中，需要考虑的主要有下面三点：</p>
<p><strong>1. 使用<a href="http://nshipster.com/nshashtable-and-nsmaptable/" target="_blank" rel="noopener">NSHashTable</a> 处理循环引用问题</strong></p>
<p>既然是一对多，肯定需要有容器保存delegate指针，出于避免循环引用等问题的考虑，目前使用<code>NSHashTable</code>代替了数组或者字典。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)init&#123;</span><br><span class="line">    _delegates = [NSHashTable hashTableWithOptions:NSHashTableWeakMemory];</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addDelegate:(id)delegate&#123;</span><br><span class="line">    if (delegate != nil) &#123;</span><br><span class="line">        [_delegates addObject:delegate];</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        NSAssert(NO, @&quot;delegate couldn&apos;t be nil&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeDelegate:(id)delegate&#123;</span><br><span class="line">    [_delegates removeObject:delegate];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeAllDelegates&#123;</span><br><span class="line">    [_delegates removeAllObjects];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2. 使用message forwarding转发消息</strong></p>
<p><code>-methodSignatureForSelector:</code> 和 <code>-forwardInvocation:</code>两个方法是实现转发的关键，使用<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSProxy_Class/" target="_blank" rel="noopener">NSProxy</a> 只是因为相对于 NSObject，NSProxy更专注于消息转发，没有其他太多无关的方法。当然也可以使用NSObject来做。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    for (id delegate in _delegates) &#123;</span><br><span class="line">        </span><br><span class="line">        NSMethodSignature *result = [delegate methodSignatureForSelector:sel];</span><br><span class="line">        if (result != nil) &#123;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    // This causes a crash...</span><br><span class="line">    //        return [super methodSignatureForSelector:sel];</span><br><span class="line">    return [[self class] instanceMethodSignatureForSelector:@selector(doNothing)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)forwardInvocation:(NSInvocation *)invocation</span><br><span class="line">&#123;</span><br><span class="line">    SEL sel = invocation.selector;</span><br><span class="line">    </span><br><span class="line">    for (id delegate in _delegates) &#123;</span><br><span class="line">        if ([delegate respondsToSelector:sel]) &#123;</span><br><span class="line">            [invocation invokeWithTarget:delegate];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            </span><br><span class="line">            // This causes a crash...</span><br><span class="line">            //        [super forwardInvocation:invocation];</span><br><span class="line">            [self doNothing];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)doNothing&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3. 处理 @optional的协议方法 crash问题</strong></p>
<p>协议不可能都是 @required 肯定还有 @optional，在转发中记得处理可能crash的情况。</p>
<p>使用Multicast Delegate，<strong>中间多了一层 protocol 关联</strong>，某种情况下可以解决NSNotificationCenter 跨层带来的过于松散等问题。</p>
<p><a href="https://github.com/MrBoog/SafeMulticastDelegate" target="_blank" rel="noopener">DEMO 地址</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/28/2015-12-28-gcd-synchron/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/28/2015-12-28-gcd-synchron/" itemprop="url">GCD同步操作之 barriers  groups  semaphore</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-28T21:41:55+08:00">
                2015-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/12/28/2015-12-28-gcd-synchron/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/12/28/2015-12-28-gcd-synchron/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在学会简单的使用GCD处理多线程之后，我们来再深入了解下GCD对多线程的一些同步控制。</p>
<h2 id="dispatch-barriers"><a href="#dispatch-barriers" class="headerlink" title="dispatch barriers"></a>dispatch barriers</h2><p>在使用 Concurrent Queue 的时候，有时候我们希望队列中的某项任务，能够被串行执行，来避免资源竞争等多线程问题。比如遇到读写问题，这时候我们就需要使用 dispatch barriers。来保证即使在并行队列中，对某个对象的读和写操作，在同一时刻，只有一个可以被执行。这时候就可以用到 dispatch barriers了。下面我们来讨论一下，不同的队列中barriers的使用：</p>
<ul>
<li><p>Custom Serial Queue: 在串行队列中，队列都是顺序串行执行，使用barriers没有任何好处。一般来讲我们不需要这么做。</p>
</li>
<li><p>Global Concurrent Queue: 这里虽然是并行队列，但这个队列是全局的，我们不能保证别人没有使用这个队列。对这个队列加barriers，可能会影响到其他模块的功能。所以不建议在这个队列中使用。</p>
</li>
<li><p>Custom Concurrent Queue: 在自定义的并行队列中使用barriers，是比较合适的方式。</p>
</li>
</ul>
<p>所以当我们要做的并行操作，可能存在线程安全问题的时候。我们最好考虑新建自定义并行队列，而不是简单地使用系统提供的 Global Queue。</p>
<p>举一个例子，假设某一个类要管理MyClass这个类型的读写，下面列举这个类的一些相关方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//初始化自定义并发队列</span><br><span class="line">- (instancetype)init&#123;</span><br><span class="line">  	</span><br><span class="line">	if(self = [super init])&#123;</span><br><span class="line">		customConcurrentQueue = dispatch_queue_create(&quot;com.customConcurrentQueue&quot;, DISPATCH_QUEUE_CONCURRENT); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//写方法</span><br><span class="line">- (void)write:(MyClass *)myClass &#123;</span><br><span class="line"></span><br><span class="line">	if( myClass )&#123;</span><br><span class="line">		</span><br><span class="line">		//使用barrier，保证写方法，可以串行执行</span><br><span class="line">           dispatch_barrier_async(self.customConcurrentQueue, ^&#123; </span><br><span class="line">           	</span><br><span class="line">           	//写操作</span><br><span class="line">           	...</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//读方法</span><br><span class="line">- (MyClass *)read&#123;</span><br><span class="line">	</span><br><span class="line">	//要保证，读和写方法不能同时执行，</span><br><span class="line">	//首先，他们要在同一个队列中 ：self.customConcurrentQueue</span><br><span class="line">	//其次，读方法要等待读出数据后返回，所以应该是同步操作 ：dispatch_sync</span><br><span class="line">	</span><br><span class="line">	__block MyClass *myClass = [[MyClass alloc] init];</span><br><span class="line">	</span><br><span class="line">	dispatch_sync(self.customConcurrentQueue, ^&#123;</span><br><span class="line">	</span><br><span class="line">		//读操作</span><br><span class="line">		myClass = ...</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	return myClass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="dispatch-groups"><a href="#dispatch-groups" class="headerlink" title="dispatch groups"></a>dispatch groups</h2><p>有时候，我们需要在多个并行任务全部完成后，做一些操作，这时候就需要用到 group来管理了。</p>
<p>举一个简单的例子。我有4个任务要使用并发处理，任务4要等待，任务1、2、3完成后执行。同时，任务4不阻塞当前的线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (void)testDispatchGroup&#123;</span><br><span class="line"></span><br><span class="line">	dispatch_queue_t concurrentQueue = dispatch_queue_create(&quot;com.test.testConcurrent&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">	dispatch_group_t group = dispatch_group_create();</span><br><span class="line"></span><br><span class="line">	//异步操作</span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	任务1</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	任务2</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	任务3</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	//dispatch_group_notify 中的block执行的是我们最后要做的任务。同时，这里是异步操作，不会阻塞后面其他代码的执行。</span><br><span class="line">	dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">		</span><br><span class="line">		//前面3个任务，都执行完成后，执行里面的block</span><br><span class="line">		任务4</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">    	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看另一个需求，还是之前的4个任务。唯一的区别是，任务4除了要等待其他任务完成，还要阻塞当前线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (void)testDispatchGroup&#123;</span><br><span class="line"></span><br><span class="line">	dispatch_group_t group = dispatch_group_create();</span><br><span class="line"></span><br><span class="line">	//异步操作</span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	任务1</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	任务2</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	任务3</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	//dispatch_group_wait 等待上面任务全部完成，阻塞当前线程，直到超过设置的时间</span><br><span class="line">	//使用时，要注意避免阻塞主线程等问题</span><br><span class="line">	dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</span><br><span class="line">	</span><br><span class="line">	任务4</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外，除了使用dispatch_group_async管理要做的任务。还可以使用<code>dispatch_group_enter</code>、 <code>dispatch_group_leave</code> 组合的方式，手动通知任务完成。如果使用手动管理的话，我们要注意：<code>enter和leave方法，应该是成对出现的</code>。</p>
<p>dispatch_group_enter(customGroup) : 手动告知customGroup，表示一个任务已经开始执行。 </p>
<p>dispatch_group_leave(customGroup) : 手动告知customGroup，表示一个任务已经完成。当所有enter对应的leave方法都执行过后。我们的<code>dispatch_group_notify()</code>或者<code>dispatch_group_wait()</code>，就可以接到任务完成的通知。</p>
<hr>
<h2 id="dispatch-semaphore-信号量"><a href="#dispatch-semaphore-信号量" class="headerlink" title="dispatch semaphore 信号量"></a>dispatch semaphore 信号量</h2><p>当有多个消费者，访问有限的资源的时候，<a href="https://en.wikipedia.org/wiki/Semaphore_(programming\" target="_blank" rel="noopener">信号量</a>) 可以让我们更好的控制。简单来说，我们通过对信号个数的控制，来达到线程间的同步操作。当信号个数为0的时候，当前线程被阻塞，等待信号量增加，当信号量个数大于0的时候，则线程继续执行。 </p>
<p>注意，同步的操作都要小心使用，避免死锁等问题。</p>
<p>另外，根据dispatch_semaphore_wait的返回值，可以用于判断某任务是否超时操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void)testSemaphore&#123;</span><br><span class="line"></span><br><span class="line">	//创建 信号量 参数代表初始个数</span><br><span class="line">	dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">	</span><br><span class="line">		sleep(2);</span><br><span class="line">	</span><br><span class="line">		//发送一个信号，信号量个数 +1	</span><br><span class="line">		dispatch_semaphore_signal(semaphore);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">	</span><br><span class="line">		dispatch_time_t timeoutTime = dispatch_time(DISPATCH_TIME_NOW, 1 * NSEC_PER_SEC);</span><br><span class="line">	</span><br><span class="line">		//线程等待，当信号量大于0时 任务继续执行，信号量 -1</span><br><span class="line">		//线程等待，超过预定的超时时间 任务继续执行 信号量不变</span><br><span class="line">		//关于返回值：当返回值 不为0 的时候，说明超时</span><br><span class="line">		if( dispatch_semaphore_wait(semaphore, timeoutTime) )&#123;</span><br><span class="line">			NSLog(@&quot;time out&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/14/2015-12-14-gcd-part-1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/14/2015-12-14-gcd-part-1/" itemprop="url">GCD 同步与异步 串行与并行</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-14T15:25:27+08:00">
                2015-12-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/12/14/2015-12-14-gcd-part-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/12/14/2015-12-14-gcd-part-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>GCD是iOS开发多线程中经常使用的技术，先看一下GCD中的常见的术语</p>
<p>描述多个任务之间同一时刻的运行关系：</p>
<ul>
<li>serial（串行） 某一时刻，只执行一个任务</li>
<li>concurrent（并行） 可以同时执行多个任务</li>
</ul>
<p>侧重描述一个函数的执行完成，对其他任务的影响 (既 是否任务在等待某个函数完成，然后才可以运行)：</p>
<ul>
<li>synchronous（同步） 任务执行完成后reture，（阻塞）</li>
<li>asynchronous（异步） 不等待任务执行完成，立即reture，（不阻塞当前）</li>
</ul>
<p>在GCD中，我们用串行并行描述队列。这就是在描述，该队列里面的所有任务，相互之间在同一时刻，是怎样的运行关系。是指队列内本身的任务运行顺序。<br>我们还用同步异步，描述某一个任务。比如说任务A是同步执行的。这就是在说，A任务，会阻塞当前任务，直到A结束。这是指不同任务之间的关系，与队列无关，可以是不同队列，也可以是相同队列。</p>
<p>接下来，我们先来看下，GCD里面的不同队列。</p>
<hr>
<h2 id="Serial-Queues"><a href="#Serial-Queues" class="headerlink" title="Serial Queues"></a>Serial Queues</h2><p>在串行队列里，同一时间只能执行一个任务。任务按照被添加进入队列的顺序依次执行。每一个任务只有在前面的任务完成后，才可以开始执行。</p>
<p>系统为我们提供的串行队列</p>
<ul>
<li><p>main queue ( dispatch_get_main_queue )</p>
<p>  main queue是一个串行队列，有串行队列的一切特性。比较特殊的一点是加入这个队列的任务，都是在主线程执行的。</p>
</li>
</ul>
<h2 id="Concurrent-Queues"><a href="#Concurrent-Queues" class="headerlink" title="Concurrent Queues"></a>Concurrent Queues</h2><p>加入并行队列的任务，执行的顺序也是按照任务被加入队列的顺序执行，这是我们唯一可以保证的。每个任务都不用等待之前的任务完成，同一时刻可以多个任务同时执行。</p>
<p>系统同样有一个全局的并发队列</p>
<ul>
<li><p>global dispatch queue ( dispatch_get_global_queue )</p>
<p>  这是另一个我们熟悉的并发队列，很多时候我们直接使用这个队列，可以简单处理一些我们需要并发执行的任务。</p>
</li>
</ul>
<h2 id="Custom-Queue"><a href="#Custom-Queue" class="headerlink" title="Custom Queue"></a>Custom Queue</h2><p>除了系统提供的全局队列之外，我们还可以自定义串行或者并行的队列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dispatch_queue_t mySerialQueue = dispatch_queue_create(&quot;com.mySerialQueue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line">   dispatch_queue_t myConcurrentQueue = dispatch_queue_create(&quot;com.myConcurrentQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br></pre></td></tr></table></figure>
<p>上面是几种我们用GCD时，需要使用到的队列。</p>
<p>另外，使用GCD，除了选择正确的队列外，还要关注：我们要执行的任务是同步还是异步执行。</p>
<!--
同步执行 串行queue 
        并行queue

异步执行 串行queue 
        并行queue
-->
<hr>
<h2 id="dispatch-async-异步执行"><a href="#dispatch-async-异步执行" class="headerlink" title="dispatch_async  异步执行"></a>dispatch_async  异步执行</h2><p>dispatch_async 用来用异步的方式执行串行或者并行队列里面的任务，我们来看一下使用 dispatch_async 的几种常见情况：</p>
<ul>
<li>custom Serial Queue：当我们需要执行几个应该串行执行的任务，又不阻塞当前的时候。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// task1 task2 顺序依次执行，同时不阻塞others</span><br><span class="line"></span><br><span class="line">   dispatch_queue_t mySerialQueue = dispatch_queue_create(&quot;com.mySerialQueue&quot;, NULL);</span><br><span class="line">   </span><br><span class="line">   dispatch_async(mySerialQueue, ^&#123;</span><br><span class="line">      ...task1</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   dispatch_async(mySerialQueue, ^&#123;</span><br><span class="line">	...task2</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   ...others</span><br></pre></td></tr></table></figure>
<ul>
<li><p>main Queue：当我们执行并完成了一段异步的任务，需要回到主线程更新UI的时候，很常见的选择就是使用GCD的 main queue。</p>
</li>
<li><p>custom or global concurrent Queue：这个是我们执行非UI任务的常见选择。要注意的是，加入队列的多个任务之间并发执行，我们无法知道那个任务先完成。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">dispatch_queue_t myConcurrentQueue = dispatch_queue_create(&quot;com.myConcurrentQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">dispatch_async(myConcurrentQueue, ^&#123;</span><br><span class="line">	</span><br><span class="line">	...task1    </span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">       	Update UI </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="dispatch-sync-同步执行"><a href="#dispatch-sync-同步执行" class="headerlink" title="dispatch_sync 同步执行"></a>dispatch_sync 同步执行</h2><p>大部分时候我们执行dispatch_sync操作，都要格外小心些。</p>
<ul>
<li>custom or main Serial Queue： 同步执行串行队列时，要注意防止发生死锁，比如下面的代码:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//串行队列中，task2 等待 task1完成，所以不会开始。而task1又完成不了，因为task2还没有执行完(甚至都没有开始)。死锁。</span><br><span class="line">	</span><br><span class="line">    dispatch_queue_t mySerialQueue = dispatch_queue_create(&quot;com.mySerialQueue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    dispatch_sync(mySerialQueue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        ...task1</span><br><span class="line">        dispatch_sync(mySerialQueue, ^&#123;</span><br><span class="line">        	 </span><br><span class="line">        	 ...task2        	 </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>concurrent Queue：合理使用可以解决一些并发读写问题。例如</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//task1 执行结束后，task2才会开始执行。</span><br><span class="line">    dispatch_queue_t myConcurrentQueue = dispatch_queue_create(&quot;com.myConcurrentQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">    dispatch_sync(myConcurrentQueue, ^&#123;</span><br><span class="line">        </span><br><span class="line">		...task1 读</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_async(myConcurrentQueue, ^&#123;</span><br><span class="line">        </span><br><span class="line">		...task2 写</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="dispatch-after"><a href="#dispatch-after" class="headerlink" title="dispatch_after"></a>dispatch_after</h2><p>异步延迟操作。实际上 dispatch_after 就像一个延迟执行的 dispatch_async。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">double delayInSeconds = 1.0;</span><br><span class="line">   dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delayInSeconds * NSEC_PER_SEC));</span><br><span class="line">    dispatch_after(popTime, dispatch_get_main_queue(), ^(void)&#123;</span><br><span class="line"></span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/11/2015-11-11-helloreactnative/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/11/2015-11-11-helloreactnative/" itemprop="url">Hello ReactNative</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-11-11T16:09:23+08:00">
                2015-11-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/11/2015-11-11-helloreactnative/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/11/2015-11-11-helloreactnative/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>虽然很多开发者都是一直使用Oc和Swift开发iOS应用，但不得不说ReactNative的’learn-once write-anywhere’，对开发者还是有强大的吸引力的。用Js写逻辑，并且使用原生的UI，不依托于浏览器，如今的Js越来越强大。即便是使用原生语言的开发者，也应该详细了解下。</p>
<h3 id="配置-React-Native"><a href="#配置-React-Native" class="headerlink" title="配置 React Native"></a>配置 React Native</h3><p>要想在项目中使用<a href="https://facebook.github.io/react-native/docs/getting-started.html#content" target="_blank" rel="noopener">ReactNative</a>，需要先搭建Node.js环境。下面我们使用nvm，下载管理Node.js。</p>
<ul>
<li>nvm</li>
</ul>
<p>官方安装和使用 nvm 的<a href="https://github.com/creationix/nvm#installation" target="_blank" rel="noopener">步骤</a>。简单整理下：</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  	curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.30.2/install.sh | bash</span><br><span class="line"></span><br><span class="line">sh ~/.nvm/nvm.sh</span><br></pre></td></tr></table></figure>
<p>把下面的内容追加到 <code>~/.bashrc</code> 和 <code>~/.profile</code> 中</p>
<p>例如：vim ~/.bashrc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.nvm/nvm.sh</span><br></pre></td></tr></table></figure>
<p>完成后重启终端</p>
<p>使用nvm下载Node：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//查看支持版本</span><br><span class="line">nvm ls-remote</span><br><span class="line">	</span><br><span class="line">nvm install v5.5.0</span><br><span class="line"></span><br><span class="line">nvm use v5.5.0</span><br></pre></td></tr></table></figure>
<p>或者直接下载最新版本的Node</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install node &amp;&amp; nvm alias default node</span><br></pre></td></tr></table></figure>
<ul>
<li>安装watchman</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install watchman</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 React Native CLI tool</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g react-native-cli</span><br></pre></td></tr></table></figure>
<p>准备工作基本结束</p>
<hr>
<h3 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h3><p>下面我们选择一个目录，新建一个ReactNative项目。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native init HelloReactNative</span><br></pre></td></tr></table></figure>
<p>找到index.ios.js，替换一下下面的代码。找到iOS文件夹下面的工程，运行一下，一个简单用ReactNative实现的helloworld程序，就可以跑起来了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var React = require(&apos;react-native&apos;);</span><br><span class="line"></span><br><span class="line">var styles = React.StyleSheet.create(&#123;</span><br><span class="line">  text: &#123;</span><br><span class="line">    color: &apos;black&apos;,</span><br><span class="line">    backgroundColor: &apos;white&apos;,</span><br><span class="line">    fontSize: 30,</span><br><span class="line">    margin: 80</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// for app itself</span><br><span class="line">class ReactNativeDemoApp extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return React.createElement(React.Text, &#123;style: styles.text&#125;, &quot;Hello World&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">React.AppRegistry.registerComponent(&apos;HelloReactNative&apos;, () =&gt; ReactNativeDemoApp);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/09/30/2015-09-30-guan-yu-nsoperation/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/09/30/2015-09-30-guan-yu-nsoperation/" itemprop="url">NSOperation</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-09-30T17:56:07+08:00">
                2015-09-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/09/30/2015-09-30-guan-yu-nsoperation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/09/30/2015-09-30-guan-yu-nsoperation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>NSOperation 是 abstract class 抽象类，不能直接使用，我们使用的时候，一般要子类化，或者直接使用系统提供的两个子类：</p>
<ul>
<li>NSInvocationOperation</li>
<li>NSBlockOperation</li>
</ul>
<p>虽然GCD使用起来很方便，但使用不当也会暴露一些问题，比如对任务状态的不好控制等。这可能导致有些我们本来需要取消掉的任务，一直在运行，占用资源。这些情况下我们可以考虑通过 NSOperationQueue 加强对任务的控制。</p>
<hr>
<h4 id="NSInvocationOperation"><a href="#NSInvocationOperation" class="headerlink" title="NSInvocationOperation"></a>NSInvocationOperation</h4><p>NSInvocationOperation是抽象类NSOperation的实体子类，可以直接使用。如果不结合NSOperationQueue，单独通过调用 start方法使用，NSInvocationOperation是非并发的操作。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   // 通过 start 直接调用，任务将在主线程中执行。</span><br><span class="line">   NSInvocationOperation *invocationOp = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(doSomeThingWithInvocation:) object:nil];</span><br><span class="line">   [invocationOp start];</span><br><span class="line"></span><br><span class="line">// 或者通过 addOperation 将任务加入队列，可在子线程中执行</span><br><span class="line">myOperationQueue = [[NSOperationQueue alloc] init];</span><br><span class="line">[myOperationQueue addOperation:invocationOp];</span><br></pre></td></tr></table></figure>
<p>当然，在swift中,NSInvocation相关的类，都已经去掉了(不知道以后会不会加入)，也许NSInvocationOperation也是退出历史舞台的节奏。</p>
<hr>
<h4 id="NSBlockOperation"><a href="#NSBlockOperation" class="headerlink" title="NSBlockOperation"></a>NSBlockOperation</h4><p>NSBlockOperation也是NSOperation的子类，只是跟NSInvocationOperation使用NSInvocation不同，NSBlockOperation使用block，使用起来会更方便。        </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">myOperationQueue = [[NSOperationQueue alloc] init];	  	   </span><br><span class="line">NSBlockOperation *blockOp = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">       //需要执行的任务</span><br><span class="line">   &#125;];</span><br><span class="line">   </span><br><span class="line">   [blockOp addExecutionBlock:^&#123;</span><br><span class="line">       //需要执行的任务</span><br><span class="line">   &#125;];</span><br><span class="line">   </span><br><span class="line">   // finished属性为YES后(完成或者被取消)将会执行</span><br><span class="line">   __weak NSBlockOperation *weakOp = blockOp;</span><br><span class="line">   [blockOp setCompletionBlock:^&#123;</span><br><span class="line">	</span><br><span class="line">	if (!weakOp.isCancelled) &#123;</span><br><span class="line">	</span><br><span class="line">		[[NSOperationQueue mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line">        	//更新主线程</span><br><span class="line">   	    &#125;];			</span><br><span class="line">	&#125;</span><br><span class="line">   &#125;];</span><br><span class="line"></span><br><span class="line">[myOperationQueue addOperation:blockOp];</span><br></pre></td></tr></table></figure>
<p>上面代码，block相互之间都是并行异步的。也就是说可以同时执行多个block，不同block之间不会相互阻塞。不用等待依赖其他block完成。block内部是顺序执行的。 </p>
<p>通过添加依赖，来控制不同的NSBlockOperation之间是否完全并行执行。注意不要循环依赖导致死锁。    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">NSBlockOperation *blockOp2 = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">	//需要执行的任务</span><br><span class="line">   &#125;];</span><br><span class="line">   </span><br><span class="line">   //blockOp2 将等待至 blockOp 结束后，开始执行</span><br><span class="line">   [blockOp2 addDependency:blockOp];</span><br><span class="line">[myOperationQueue addOperation:blockOp2];</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="子类化自定义NSOperation"><a href="#子类化自定义NSOperation" class="headerlink" title="子类化自定义NSOperation"></a>子类化自定义NSOperation</h4><p>我们可以选择重写 <code>main</code> 方法，或者 <code>start</code> 方法，来实现。</p>
<ul>
<li>main：重写main方法，不需要手动管理太多状态，使用起来比较简单。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void)main &#123;</span><br><span class="line">   	@autoreleasepool &#123;</span><br><span class="line"></span><br><span class="line">		//在这里，我们要频繁的检测 isCancelled 属性</span><br><span class="line">		if(self.isCancelled)&#123;</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>start：我们一般不会重写start，相对于重写main方法，处理上要更复杂些。要自己注意任务的一些状态比如isExecuting，isFinished，isConcurrent(isAsynchronous)，isReady。注意，当实现了start，就不会执行main。</li>
</ul>
<ul>
<li>dependency：任务之间添加依赖。有时候某一个任务，需要等待其他任务的结束后才能开始。这时候，相对于使用GCD的dispatch_barrier_async更容易理解一些。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//在op2的任务尚未执行时，添加依赖，op2将等待直到op完成</span><br><span class="line">[op2 addDependency:op];</span><br><span class="line">//移出op2的依赖</span><br><span class="line">[op2 removeDependency:op];</span><br></pre></td></tr></table></figure>
<ul>
<li>Completion block：任务完成后的回调，要注意此时并没有回到主线程。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">__weak NSBlockOperation *weakOp = blockOp;</span><br><span class="line">[blockOp setCompletionBlock:^&#123;</span><br><span class="line">    </span><br><span class="line">    if ( !weakOp.isCancelled ) &#123;</span><br><span class="line">        [[NSOperationQueue mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line"></span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>另外有几点需要注意：</p>
<ul>
<li><p>已经完成的任务，不能被重新执行。    </p>
</li>
<li><p>已经添加到队列的任务，也不能被重复添加。    </p>
</li>
<li><p>当我们对一个任务发送<code>cancel</code>消息时，属性isCancelled会变为YES。    不过，对于自定义的NSOperation来说，要格外注意些。</p>
<p>  在发送cancel消息的时候，如果任务还未开始执行(isExecuting == NO)，就会被 finished 并 从队列中 remove 。</p>
<p>  如果任务正在执行中，这时候任务不会被强制结束。所以这时候，我们要在main方法中，手动检测(isCancelled == YES)并处理。        </p>
</li>
<li>isFinished等于YES，不代表任务成功完成。也可能任务被取消。所以有时候，我们在Completion block回调中，需要判断任务是否被取消。</li>
</ul>
<hr>
<h4 id="NSOperationQueue"><a href="#NSOperationQueue" class="headerlink" title="NSOperationQueue"></a>NSOperationQueue</h4><p>我们有两种不同的队列，主队列和自定义队列。主队列在主线程运行，自定义会开启子线程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">NSOperationQueue *mainQueue = [NSOperationQueue mainQueue];  </span><br><span class="line">NSOperationQueue *queue = [[NSOperationQueue alloc] init];</span><br></pre></td></tr></table></figure>
<p>使用NSOperationQueue    的时候，系统默认会根据当前资源使用的情况，来为我们考虑最合适的线程数。当然我们也可以手动设置<code>maxConcurrentOperationCount</code>，限制使用的最大的线程数。更多的时候，其实我们不关心，交给系统处理就好。        </p>
<ul>
<li><p>name：一般我们使用队列的时候，都要给一个队列名字，方便我们维护debug。</p>
</li>
<li><p>suspended：用来暂停和恢复队列中的所有任务。不能单独针对队列中的某一个任务。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// Suspend</span><br><span class="line">[myOperationQueue setSuspended:YES];</span><br><span class="line">... </span><br><span class="line">// Resume</span><br><span class="line">[myOperationQueue setSuspended:NO];</span><br></pre></td></tr></table></figure>
<ul>
<li>operationCount (readonly)：获取队列中还存在的正在执行的、等待执行的任务数量。注意，当任务一旦finished，就会从队列中remove。        </li>
<li>cancelAllOperations：对队列所有的operations，发送<code>cancel</code>消息，将 isCancelled 属性设置为 YES 。如我们之前讨论过的，当operation 的 isExecuting 状态为 NO 时，operation 会被 finished 并从队列中 remove 。如果 isExecuting 状态为 YES ，那么我们自定义的operation，就要手动检测 isCancelled 属性。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/thumbnail.JPG" alt="Huan Liu">
            
              <p class="site-author-name" itemprop="name">Huan Liu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/MrBoog" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:iosboog@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/2007403/boog" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/boogaloo.l" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2013 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huan Liu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://disqus_3DtNmleMoQ.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
