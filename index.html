<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="keywords" content="swift python objective-c">
<meta property="og:type" content="website">
<meta property="og:title" content="MrBoog Zone">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="MrBoog Zone">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MrBoog Zone">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>MrBoog Zone</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-133159358-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MrBoog Zone</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Welcome bro!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/17/2017-03-17-scripting-swift/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/17/2017-03-17-scripting-swift/" itemprop="url">Scripting Swift</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-17T17:19:06+08:00">
                2017-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/17/2017-03-17-scripting-swift/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/03/17/2017-03-17-scripting-swift/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä½œä¸ºiOSå¼€å‘è€…ï¼ŒSwiftæ–­æ–­ç»­ç»­ä¹Ÿç”¨äº†å‡ å¹´äº†ï¼Œä¸å¾—ä¸è¯´è¿˜çœŸæ˜¯å¾ˆå¥½ç”¨çš„ã€‚ä½†å…¶å®swiftä¸ä»…å¯ä»¥ç”¨æ¥å†™ iOS or Mac OSï¼Œåªè¦è£…äº†Xcodeï¼Œ<strong>Swift åœ¨Macç³»ç»Ÿä¸‹å†™èµ·è„šæœ¬æ¥ä¸€æ ·å¾ˆå¥½ç”¨çš„ã€‚</strong></p>
<p>Wellâ€¦ Long story short,  Letâ€™s Get Started~~</p>
<h3 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello world"></a>Hello world</h3><p>é¦–å…ˆï¼Œæœ€ç®€å•çš„ï¼Œæˆ‘ä»¬å…ˆæ¥åœ¨ç»ˆç«¯ç”¨swiftè¾“å‡ºhello worldè¯•è¯•ã€‚<br>è¾“å…¥ <strong>swift</strong> into the terminalç„¶åå›è½¦ï¼Œè¾“å…¥ä»»ä½•swiftè¯­å¥æ¯”å¦‚æ‰“å°hello worldï¼Œä½¿ç”¨<strong>Ctrl-D</strong>é€€å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ swift</span><br><span class="line">Welcome to Apple Swift. Type :help for assistance.</span><br><span class="line">1&gt; print(â€œHello Worldâ€)</span><br><span class="line">2&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™å°±åƒPythonä¸€æ ·ï¼Œswiftå‘½ä»¤è¡Œçš„äº¤äº’æ¨¡å¼å«åš <a href="https://developer.apple.com/swift/blog/?id=18" target="_blank" rel="noopener"><strong>Swift REPL (read eval print loop)</strong></a>ã€‚<br>æ—¢ç„¶æ˜¯æŒ‰ç…§è„šæœ¬æ‰§è¡Œï¼Œè‚¯å®šå°±å­˜åœ¨è¿™å¯¹åº”çš„è§£ææ‰§è¡Œè„šæœ¬çš„ç¨‹åºã€‚å…ˆçœ‹çœ‹æˆ‘ä»¬å¹³æ—¶ç”¨çš„bashï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/shells</span><br><span class="line"># List of acceptable shells for chpass(1).</span><br><span class="line"># Ftpd will not allow users to connect who are not using</span><br><span class="line"># one of these shells.</span><br><span class="line"></span><br><span class="line">/bin/bash</span><br><span class="line">/bin/csh</span><br><span class="line">/bin/ksh</span><br><span class="line">/bin/sh</span><br><span class="line">/bin/tcsh</span><br><span class="line">/bin/zsh</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå½“ç„¶æ²¡æœ‰äº†ï¼Œä¸è¿‡å¦‚æœæˆ‘ä»¬æ‰§è¡Œtypeå‘½ä»¤å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ type swift</span><br><span class="line">swift is hashed (/usr/bin/swift)</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°<strong>/usr/bin/swift</strong>äº†å—ï¼Œäº‹å®ä¸Šè¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„äº†ã€‚</p>
<p>åœ¨swiftè„šæœ¬æ–‡ä»¶æœ€ä¸Šé¢åŠ ä¸Š<strong>#!/usr/bin/swift</strong> (æˆ–è€… <em>#!/usr/bin/env swift</em>) å°±å¯åŠ¨swiftè§£é‡Šå™¨äº†, åé¢çš„è¯­å¥å°±ä¼šåœ¨swiftç¯å¢ƒä¸‹é¢ç¼–è¯‘ã€‚æ— éœ€å¤šè¯´ï¼Œè¿™åŸºæœ¬å’Œæˆ‘ä»¬ä»¥å‰ä½¿ç”¨bashæ—¶ è¦åŠ å…¥ <strong>#!/bin/bash</strong>ä¸€æ ·ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªdemo.swiftï¼Œåšä¸ªæœ€ç®€å•çš„æµ‹è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$touch demo.swift</span><br><span class="line">$vim demo.swift</span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘demo.swiftæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/swift</span><br><span class="line"></span><br><span class="line">import Foundation </span><br><span class="line">print(&quot;hello world&quot;)</span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘ä¿å­˜åï¼Œç»™å®ƒå¯æ‰§è¡Œçš„æƒé™åï¼Œ<strong>./demo.swift</strong>è¿è¡Œè‚¯å®šå°±çœ‹åˆ°è¾“å‡ºæ•ˆæœäº†ã€‚è¿™æ ·å°±æ˜¯æœ€ç®€å•çš„swift_è„šæœ¬äº†_ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$chmod +x demo.swift</span><br><span class="line">$./demo.swift</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>
<h3 id="Demo-time"><a href="#Demo-time" class="headerlink" title="Demo time:"></a>Demo time:</h3><p>ä¸‹é¢ç®€å•å†™ä¸€ä¸ªå¯ä»¥ä¼ å‚æ•°çš„demoï¼Œå‡è®¾æˆ‘ä»¬è¦åšä¸€ä¸ªå¯ä»¥ä¸€é”®å¤‡ä»½æˆ‘çš„åšå®¢çš„åŠŸèƒ½ã€‚å…¶å®å°±æ˜¯æŠŠæ–‡ç« Pushåˆ°å¯¹åº”çš„GitæœåŠ¡å™¨ã€‚</p>
<p>æŒ‰ç…§ä¹‹å‰çš„æ­¥éª¤ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ backup.swiftæ–‡ä»¶ï¼Œç”¨æ¥æäº¤æˆ‘çš„åšå®¢åˆ°gitæœåŠ¡å™¨ï¼ŒåŒæ—¶éœ€è¦æ·»åŠ æœ¬æ¬¡æäº¤ç›¸åº”çš„æè¿°ã€‚è¿™æ ·çš„è¯ï¼Œè¿™é‡Œæˆ‘ä»¬è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>æ—¢ç„¶æäº¤çš„æè¿°æ˜¯åŠ¨æ€çš„ï¼Œéœ€è¦é€šè¿‡å‚æ•°ä¼ å…¥ã€‚æˆ‘ä»¬å°±èƒ½è·å–åˆ°å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ã€‚</li>
<li>éœ€è¦åœ¨swifté‡Œé¢è°ƒç”¨å…¶ä»–å‘½ä»¤è¡Œå·¥å…·ï¼Œæ¯”å¦‚è¯­å¥: git pullã€‚</li>
</ol>
<p>è¦è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¼•ç”¨ä¸€ä¸ªæ–°çš„ç±»<strong>CommandLine</strong> (æˆ–è€…æ›´åŸºç¡€çš„<code>C_ARGC</code> and <code>C_ARGV</code>ä¹Ÿå¯ä»¥)ã€‚<br>CommandLine.argumentsæ˜¯ä¸ªæ•°ç»„ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å®ƒæ‹¿åˆ°æƒ³è¦çš„å‚æ•°ã€‚<br>è‡³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥å¦ä¸€ä¸ªåœ¨Swiftè„šæœ¬ä¸­å¾ˆé‡è¦ç±» <strong>Process</strong>ã€‚Processå¾ˆå¼ºå¤§ï¼Œå¯ä»¥æ··åˆ swiftå’Œbashã€‚è¿™è®©æˆ‘ä»¬åœ¨swiftä¸­ä½¿ç”¨gitå‘½ä»¤æˆä¸ºå¯èƒ½ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯ç¼–å†™åçš„backup.swiftæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/swift</span><br><span class="line"></span><br><span class="line">import Foundation</span><br><span class="line"></span><br><span class="line">func backup() &#123;</span><br><span class="line">    let args = CommandLine.arguments</span><br><span class="line">    guard args.count &gt; 1 else &#123;</span><br><span class="line">        return print(&quot;Backup Failed! : \n    Detail: Missing commit message whick should be surrounded by quotation mark.&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    let arg = args[1]</span><br><span class="line">    shell(&quot;git&quot;, &quot;pull&quot;)</span><br><span class="line">    shell(&quot;git&quot;, &quot;commit&quot;, &quot;-am&quot;, arg)</span><br><span class="line">    shell(&quot;git&quot;, &quot;push&quot;, &quot;origin&quot;, &quot;HEAD:source&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@discardableResult</span><br><span class="line">func shell(_ args: String...) -&gt; Int32 &#123;</span><br><span class="line">    let task = Process()</span><br><span class="line">    task.launchPath = &quot;/usr/bin/env&quot;</span><br><span class="line">    task.arguments = args</span><br><span class="line">    task.launch()</span><br><span class="line">    task.waitUntilExit()</span><br><span class="line">    return task.terminationStatus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backup()</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡½æ•° <code>shell(_ args: String...) -&gt; Int32</code> ç”¨æ¥å®ç°Swiftè°ƒç”¨å…¶ä»–å‘½ä»¤è¡Œå‘½ä»¤ã€‚<code>backup()</code> ä¼šå…ˆè¯»å–è¾“å…¥çš„å‚æ•°ï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„å¤‡ä»½æ“ä½œã€‚<br>æŠŠè¿™ä¸ªè„šæœ¬æ”¾åœ¨æˆ‘çš„åšå®¢gitç›®å½•ä¸‹ï¼Œè¿è¡Œå°±ä¼šè‡ªåŠ¨å¼€å§‹å°†å†…å®¹Pushåˆ°gitæœåŠ¡å™¨äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./backup.swift &quot;Blog: Backup&quot;</span><br><span class="line">remote: Enumerating objects: 139, done.</span><br><span class="line">remote: Counting objects: 100% (139/139), done.</span><br><span class="line">remote: Compressing objects: 100% (33/33), done.</span><br><span class="line">remote: Total 149 (delta 53), reused 139 (delta 53), pack-reused 10</span><br><span class="line">Receiving objects: 100% (149/149), 61.23 KiB | 61.00 KiB/s, done.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/11/2017-02-11-apns-token-based-connection/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/11/2017-02-11-apns-token-based-connection/" itemprop="url">APNs Token-Based Connection</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-11T20:17:59+08:00">
                2017-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/11/2017-02-11-apns-token-based-connection/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/02/11/2017-02-11-apns-token-based-connection/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2016å¹´è‹¹æœä¸Šçº¿äº†æ–°çš„æ¨é€éªŒè¯æ–¹å¼ï¼Œä½¿ç”¨æ–°çš„æ–¹å¼æˆ‘ä»¬å°†ä¸å†éœ€è¦ä¹‹å‰çš„ <strong>.p12</strong>æˆ–è€…<strong>.pem</strong>æ–‡ä»¶ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ª<strong>.p8</strong>æ–‡ä»¶ (å¹¶ä¸”ä¸ç”¨åŒºåˆ†devå’Œreleaseç¯å¢ƒ)ã€‚ä¸€äº›å¤§çš„æ¨é€æœåŠ¡å‚å•†å·²ç»å¼€å§‹æ”¯æŒè¿™ç§æ–°çš„æ–¹å¼äº†ï¼Œæ¯”å¦‚å›½å¤–çš„<a href="https://firebase.google.com/docs/cloud-messaging/ios/certs" target="_blank" rel="noopener">Firebase</a>ã€‚è¿™ç§æ–°çš„æ–¹å¼ä¼˜åŠ¿è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œæ¯”å¦‚è¯´</p>
<ul>
<li>é€Ÿåº¦æ›´å¿« </li>
<li>å¯ä»¥æ”¯æŒåŒä¸€å¼€å‘è€…è´¦å·ä¸‹çš„å¤šä¸ªApp </li>
<li>æ”¯æŒå¤šä¸ªåå°åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªæ–‡ä»¶ </li>
<li>ä¸éœ€è¦è€ƒè™‘ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒ</li>
<li>ä¸ä¼šè¿‡æœŸ</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶æ–°çš„æ¨é€éªŒè¯æ°¸è¿œä¸ä¼šè¿‡æœŸï¼Œä½†è®¤è¯å¯†é’¥å’Œ<strong>.p8</strong>æ–‡ä»¶éœ€è¦ä¸¥æ ¼ä¿å¯†ã€‚å¦‚æœå‘ç°æœ‰æ³„éœ²é£é™©ï¼Œå»ºè®®èµ¶ç´§revokeç„¶åé‡æ–°åˆ›å»ºã€‚</p>
<p>ç”±äºä¸å†éœ€è¦åˆ†åˆ«é…ç½®devå’Œreleaseç¯å¢ƒçš„è¯ä¹¦ï¼Œæ‰€ä»¥æµ‹è¯•çš„æµç¨‹ä¹Ÿä¼šç®€åŒ–ã€‚<strong>æ¨èä¸€ä¸ªå¼€æºçš„åŸºäºNode.jsçš„<a href="https://www.npmjs.com/package/apn" target="_blank" rel="noopener">æ¨é€åå°</a>ã€‚</strong> æˆ‘æ˜¯åªç”¨äºæµ‹è¯•çš„ï¼Œæ¯•ç«ŸçœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒå¤§å®¶éƒ½è¿˜æ˜¯åœ¨ç”¨ä¸€äº›å¤§å‚çš„æœåŠ¡ï¼Œæ¯”å¦‚è°·æ­Œçš„Firebaseæˆ–è€…å›½å†…çš„å‹ç›Ÿæ¨é€ç­‰ã€‚è¿™é‡Œæœ‰ä¸ªç®€å•ç”¨è¿™ä¸ªNode.jsçš„<a href="https://github.com/MrBoog/Test-ANPS-with-p8-file" target="_blank" rel="noopener">Demo</a>, å¯ä»¥ç”¨äºå¼€å‘è€…è‡ªå·±æµ‹è¯•æ¨é€ä½¿ç”¨ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/10/2017-01-10-symbolicating-crash-log/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/10/2017-01-10-symbolicating-crash-log/" itemprop="url">Symbolicating crash log</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-10T17:23:39+08:00">
                2017-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/10/2017-01-10-symbolicating-crash-log/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/01/10/2017-01-10-symbolicating-crash-log/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>When our App crashes, a crash report is created and stored on the device. But usually, we need to symbolicate the log before analyzing it. So here I write down the steps to symbolicate crash log.</p>
<ol>
<li><p>Create a new folder. Place our crash file and dSYM file in that folder: </p>
<ul>
<li>myApp.crash</li>
<li>myApp.dSYM</li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>Find <code>symbolicatecrash</code> file in your Xcode (which is written by perl). Copy it to the folder that you just created.</p>
<p>Usually, the path should be:<br>â€‹    <strong>/Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash</strong></p>
<p>Or, You could find the path by yourself:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /Applications/Xcode.app -name symbolicatecrash -type f</span><br></pre></td></tr></table></figure>
</li>
<li><p>export env var</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export DEVELOPER_DIR=&quot;/Applications/Xcode.app/Contents/Developer&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Final step, symbolicate crash </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./symbolicatecrash myApp.crash &gt; SymbolicatedM.crash</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Ok alright, weâ€™ve already done all of the work. So if the dSYM is matched with the crash file, here should be possible to generate a new file: <strong>SymbolicatedM.crash</strong>. Just open it, after symbolicating it should be easy to read this time.</p>
<hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/22/2016-06-22-class-cluster/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/22/2016-06-22-class-cluster/" itemprop="url">Class cluster</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-06-22T20:29:41+08:00">
                2016-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/22/2016-06-22-class-cluster/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/22/2016-06-22-class-cluster/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Class clusterï¼Œç±»ç°‡ï¼Œè¿™æ˜¯è‹¹æœå¯¹æŠ½è±¡å·¥å‚æ¨¡å¼ä¸€ç§åº”ç”¨ï¼Œåœ¨è‹¹æœçš„Frameworkä¸­ä½¿ç”¨å¹¿æ³›ï¼Œæ˜¯å®šä¹‰äº†ç›¸åŒçš„æ¥å£ï¼Œå¹¶æä¾›ç›¸åŒåŠŸèƒ½çš„ä¸€ç»„ç±»çš„é›†åˆã€‚ç±»ç°‡ä¼šæœ‰ä¸€ä¸ªå…¬å…±æŠ½è±¡è¶…ç±»ï¼Œæ¯”å¦‚NSString,NSArray,NSNumber,NSDictionaryç­‰ç­‰ï¼Œæ¥å®Œæˆå®ä¾‹åŒ–ä¸€ä¸ªå…·ä½“çš„ç§æœ‰å­ç±»ã€‚å¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œåªéœ€è¦çŸ¥é“æœ‰å…¬å…±è¶…ç±»å„ç§APIçš„ä½œç”¨å°±å¯ä»¥ï¼Œä¸éœ€è¦çŸ¥é“ï¼Œè¶…ç±»èƒŒåå­ç±»çš„å®é™…å®ç°ã€‚</p>
<h5 id="self-super-init"><a href="#self-super-init" class="headerlink" title="self = [super init]"></a>self = [super init]</h5><p>æˆ‘ä»¬åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆsuper initè°ƒç”¨è¿‡åï¼Œä¼šèµ‹å€¼ç»™selfå‘¢ï¼Ÿå› ä¸ºç³»ç»Ÿæœ‰å¾ˆå¤šæ—¶å€™ä½¿ç”¨äº†ç±»ç°‡ï¼Œæ‰€ä»¥è¿™æ ·åšé˜²æ­¢äº§ç”Ÿçš„ç§æœ‰ç±»å’Œselfä¸åŒ¹é…ã€‚<code>å®ä¾‹çš„isaæŒ‡é’ˆç»ˆç©¶åº”è¯¥æŒ‡å‘è¿™ä¸ªç§æœ‰ç±»ï¼Œè€Œä¸æ˜¯å½“å‰çš„è¶…ç±»ã€‚</code><br>è¿™æ ·åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œselfæ‰èƒ½æ‰¾åˆ°çœŸæ­£çš„éœ€è¦æ‰§è¡Œçš„ç§æœ‰ç±»çš„æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id objc_msgSend(id self, SEL op, ...)</span><br></pre></td></tr></table></figure>
<h5 id="superclass"><a href="#superclass" class="headerlink" title="superclass"></a>superclass</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSArray *array = @[];</span><br><span class="line">NSLog(@&quot;%@&quot;,array.superclass);               //NSArray</span><br><span class="line">NSLog(@&quot;%@&quot;,NSStringFromClass(array.class)); //__NSArrayI</span><br></pre></td></tr></table></figure>
<p>å¯¹äºç±»ç°‡ä¸­çš„è¶…ç±»ï¼Œæ¯”å¦‚NSArrayï¼Œè°ƒç”¨superclasså°±ä¼šå‘ç°ï¼Œä»–çš„superclassæ‰æ˜¯çœŸæ­£çš„NSArrayã€‚</p>
<h5 id="isMemberOfClass"><a href="#isMemberOfClass" class="headerlink" title="isMemberOfClass"></a>isMemberOfClass</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSLog(@&quot;%d&quot;,[array isMemberOfClass:[NSArray class]]); //0</span><br><span class="line">NSLog(@&quot;%d&quot;,[array isKindOfClass:[NSArray class]]);   //1</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„è¾“å‡ºåŒæ ·è¯æ˜äº†è‹¹æœçš„ç±»ç°‡åˆ©ç”¨äº†å¤šæ€ï¼Œé€šè¿‡å­ç±»åŒ–å…¬å…±ç±»æ¥å®ç°ã€‚<br>ç§æœ‰å­ç±»çš„å®ç°ï¼Œéšè—åœ¨ç°‡çš„å†…éƒ¨ï¼Œä¸èƒ½è¢«ç›´æ¥è°ƒç”¨ã€‚è¿™æ ·å…¬å…±ç±»åœ¨ä½¿ç”¨ä¸­ï¼Œå®é™…ä¸Šå­˜æ”¾åœ¨å†…å­˜ä¸­çš„æ˜¯éšè—åœ¨ç±»ç°‡ä¸­çš„æŸä¸ªç§æœ‰å®ä¾‹ã€‚<br>è¿™æ ·çš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼Œé’ˆå¯¹ç±»ç°‡ï¼Œè°ƒç”¨è€…åªéœ€è¦ç®€å•çš„ä½¿ç”¨è¶…ç±»æä¾›çš„APIå³å¯ã€‚è¿™æ ·NSNumberæ ¹æ®æ•°æ®ä¸åŒçš„ç±»å‹ï¼Œè€Œæœ‰å¤šç§ä¸åŒçš„å­ç±»åŒ–çš„NSNumberï¼ŒNSArrayæ ¹æ®å­˜å‚¨ç­–ç•¥ä¸åŒä¹Ÿæœ‰ä¸åŒçš„NSArrayï¼Œè€Œè°ƒç”¨è€…å´å¯ä»¥æ ¹æœ¬ä¸ç”¨æ³¨æ„è¿™äº›ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/20/2016-04-20-gem-source-geng-huan/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/20/2016-04-20-gem-source-geng-huan/" itemprop="url">Change gem source</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-20T11:43:30+08:00">
                2016-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/20/2016-04-20-gem-source-geng-huan/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/20/2016-04-20-gem-source-geng-huan/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ¢ç”µè„‘é‡æ–°è£…podsçš„æ—¶å€™æŠ¥é”™ï¼Œå…¶å®æ˜¯gemæŠ¥é”™äº†ã€‚</p>
<p>åœ¨æ‰§è¡Œ <code>gem install cocoapods</code> çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸‹é¢çš„é”™è¯¯ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unable to download data from https://ruby.taobao.org/ - SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed (https://rubygems-china.oss-cn-hangzhou.aliyuncs.com/latest_specs.4.8.gz)</span><br></pre></td></tr></table></figure>
<p>æ„Ÿè§‰åƒæ˜¯é˜¿é‡Œæä¾›çš„æºå‡ºäº†é—®é¢˜ï¼Œç›®å‰æ‰‹ä¸Šæ²¡æœ‰vpnï¼Œåªèƒ½åœ¨githubä¸Šå‘åŸä½œè€…æäº†ä¸€ä¸ª<a href="https://github.com/alibaba/ruby.taobao.org/issues/48" target="_blank" rel="noopener">issue</a>ã€‚ä½œè€…å¾ˆå¿«ç»™äº†åé¦ˆï¼ŒåŸæ¥æ˜¯ä»–ä»¬ä¸å†ç»´æŠ¤äº†ã€‚ä¸è¿‡æ ¹æ®ä½œè€…æä¾›çš„<a href="https://ruby-china.org/topics/29250" target="_blank" rel="noopener">é“¾æ¥</a>ï¼Œæˆ‘ä»¬æ¢ä¸€ä¸‹å…¶ä»–çš„æºå°±å¯ä»¥äº†~ ä¹Ÿæ„Ÿå¹ä¸€ä¸‹å›½å†…çš„ç½‘ç»œç¯å¢ƒğŸ˜‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gem sources --remove https://ruby.taobao.org/</span><br><span class="line"></span><br><span class="line">gem sources --add https://gems.ruby-china.org/</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/14/2016-03-14-multicast-delegate-in-oc/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/14/2016-03-14-multicast-delegate-in-oc/" itemprop="url">Objective-c Multicast Delegate</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-14T20:52:33+08:00">
                2016-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/03/14/2016-03-14-multicast-delegate-in-oc/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/03/14/2016-03-14-multicast-delegate-in-oc/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>NSNotificationCenter æˆ‘ä»¬è‚¯å®šéƒ½æœ‰ä½¿ç”¨è¿‡ï¼Œé€šè¿‡å‘é€å¹¿æ’­ï¼Œå®ç°ä¸€å¯¹å¤šçš„æ¶ˆæ¯å‘é€ã€‚NSNotificationCenterä½¿ç”¨èµ·æ¥çµæ´»æ€§ç‰¹åˆ«é«˜ï¼Œä½†æœ‰æ—¶å€™è¿‡åº¦ä½¿ç”¨åè€Œæ˜¯NSNotificationCenter çš„å¼Šç«¯ã€‚åœ¨é¡¹ç›®çš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¸¸ä¼šæ€è€ƒçš„ä¸€ä¸ªé—®é¢˜ï¼š<strong>é™åˆ¶éƒ¨åˆ†çµæ´»æ€§ï¼Œä»¥æ­¤æ¥äº¤æ¢åº”ç”¨çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</strong></p>
<p>NSNotificationCenter å…è®¸åº”ç”¨å„ç§è·¨å±‚è®¿é—®ï¼Œç›‘å¬è€…è¦é…åˆåˆç†ä½¿ç”¨addã€removeç­‰æ–¹æ³•ï¼Œå‡ºäº†é—®é¢˜å®åœ¨ä¸å¥½è·Ÿè¸ªã€‚åœ¨æŸäº›æ—¶åˆ»ï¼Œéœ€è¦é…Œæƒ…è€ƒè™‘æ˜¯å¦åº”è¯¥ä½¿ç”¨ã€‚</p>
<p>å¯¹äºä¸€å¯¹å¤šçš„æ¶ˆæ¯å‘é€ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šåŠæ³•å¯ä»¥è€ƒè™‘ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>NSProxy å®ç°æ¶ˆæ¯è½¬å‘</strong>ï¼Œå°†æˆ‘ä»¬æ™®é€šä¸€å¯¹ä¸€çš„delegateæ¨¡å¼ï¼Œæ”¹ä¸ºä¸€å¯¹å¤šã€‚</p>
<p>åœ¨ç›®å‰å®ç°è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€ƒè™‘çš„ä¸»è¦æœ‰ä¸‹é¢ä¸‰ç‚¹ï¼š</p>
<p><strong>1. ä½¿ç”¨<a href="http://nshipster.com/nshashtable-and-nsmaptable/" target="_blank" rel="noopener">NSHashTable</a> å¤„ç†å¾ªç¯å¼•ç”¨é—®é¢˜</strong></p>
<p>æ—¢ç„¶æ˜¯ä¸€å¯¹å¤šï¼Œè‚¯å®šéœ€è¦æœ‰å®¹å™¨ä¿å­˜delegateæŒ‡é’ˆï¼Œå‡ºäºé¿å…å¾ªç¯å¼•ç”¨ç­‰é—®é¢˜çš„è€ƒè™‘ï¼Œç›®å‰ä½¿ç”¨<code>NSHashTable</code>ä»£æ›¿äº†æ•°ç»„æˆ–è€…å­—å…¸ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)init&#123;</span><br><span class="line">    _delegates = [NSHashTable hashTableWithOptions:NSHashTableWeakMemory];</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addDelegate:(id)delegate&#123;</span><br><span class="line">    if (delegate != nil) &#123;</span><br><span class="line">        [_delegates addObject:delegate];</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        NSAssert(NO, @&quot;delegate couldn&apos;t be nil&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeDelegate:(id)delegate&#123;</span><br><span class="line">    [_delegates removeObject:delegate];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeAllDelegates&#123;</span><br><span class="line">    [_delegates removeAllObjects];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2. ä½¿ç”¨message forwardingè½¬å‘æ¶ˆæ¯</strong></p>
<p><code>-methodSignatureForSelector:</code> å’Œ <code>-forwardInvocation:</code>ä¸¤ä¸ªæ–¹æ³•æ˜¯å®ç°è½¬å‘çš„å…³é”®ï¼Œä½¿ç”¨<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSProxy_Class/" target="_blank" rel="noopener">NSProxy</a> åªæ˜¯å› ä¸ºç›¸å¯¹äº NSObjectï¼ŒNSProxyæ›´ä¸“æ³¨äºæ¶ˆæ¯è½¬å‘ï¼Œæ²¡æœ‰å…¶ä»–å¤ªå¤šæ— å…³çš„æ–¹æ³•ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨NSObjectæ¥åšã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    for (id delegate in _delegates) &#123;</span><br><span class="line">        </span><br><span class="line">        NSMethodSignature *result = [delegate methodSignatureForSelector:sel];</span><br><span class="line">        if (result != nil) &#123;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    // This causes a crash...</span><br><span class="line">    //        return [super methodSignatureForSelector:sel];</span><br><span class="line">    return [[self class] instanceMethodSignatureForSelector:@selector(doNothing)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)forwardInvocation:(NSInvocation *)invocation</span><br><span class="line">&#123;</span><br><span class="line">    SEL sel = invocation.selector;</span><br><span class="line">    </span><br><span class="line">    for (id delegate in _delegates) &#123;</span><br><span class="line">        if ([delegate respondsToSelector:sel]) &#123;</span><br><span class="line">            [invocation invokeWithTarget:delegate];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            </span><br><span class="line">            // This causes a crash...</span><br><span class="line">            //        [super forwardInvocation:invocation];</span><br><span class="line">            [self doNothing];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)doNothing&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3. å¤„ç† @optionalçš„åè®®æ–¹æ³• crashé—®é¢˜</strong></p>
<p>åè®®ä¸å¯èƒ½éƒ½æ˜¯ @required è‚¯å®šè¿˜æœ‰ @optionalï¼Œåœ¨è½¬å‘ä¸­è®°å¾—å¤„ç†å¯èƒ½crashçš„æƒ…å†µã€‚</p>
<p>ä½¿ç”¨Multicast Delegateï¼Œ<strong>ä¸­é—´å¤šäº†ä¸€å±‚ protocol å…³è”</strong>ï¼ŒæŸç§æƒ…å†µä¸‹å¯ä»¥è§£å†³NSNotificationCenter è·¨å±‚å¸¦æ¥çš„è¿‡äºæ¾æ•£ç­‰é—®é¢˜ã€‚</p>
<p><a href="https://github.com/MrBoog/SafeMulticastDelegate" target="_blank" rel="noopener">DEMO åœ°å€</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/28/2015-12-28-gcd-synchron/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/28/2015-12-28-gcd-synchron/" itemprop="url">GCDåŒæ­¥æ“ä½œä¹‹ barriers  groups  semaphore</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-28T21:41:55+08:00">
                2015-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/12/28/2015-12-28-gcd-synchron/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/12/28/2015-12-28-gcd-synchron/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åœ¨å­¦ä¼šç®€å•çš„ä½¿ç”¨GCDå¤„ç†å¤šçº¿ç¨‹ä¹‹åï¼Œæˆ‘ä»¬æ¥å†æ·±å…¥äº†è§£ä¸‹GCDå¯¹å¤šçº¿ç¨‹çš„ä¸€äº›åŒæ­¥æ§åˆ¶ã€‚</p>
<h2 id="dispatch-barriers"><a href="#dispatch-barriers" class="headerlink" title="dispatch barriers"></a>dispatch barriers</h2><p>åœ¨ä½¿ç”¨ Concurrent Queue çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›é˜Ÿåˆ—ä¸­çš„æŸé¡¹ä»»åŠ¡ï¼Œèƒ½å¤Ÿè¢«ä¸²è¡Œæ‰§è¡Œï¼Œæ¥é¿å…èµ„æºç«äº‰ç­‰å¤šçº¿ç¨‹é—®é¢˜ã€‚æ¯”å¦‚é‡åˆ°è¯»å†™é—®é¢˜ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ dispatch barriersã€‚æ¥ä¿è¯å³ä½¿åœ¨å¹¶è¡Œé˜Ÿåˆ—ä¸­ï¼Œå¯¹æŸä¸ªå¯¹è±¡çš„è¯»å’Œå†™æ“ä½œï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå¯ä»¥è¢«æ‰§è¡Œã€‚è¿™æ—¶å€™å°±å¯ä»¥ç”¨åˆ° dispatch barriersäº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ï¼Œä¸åŒçš„é˜Ÿåˆ—ä¸­barriersçš„ä½¿ç”¨ï¼š</p>
<ul>
<li><p>Custom Serial Queue: åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—éƒ½æ˜¯é¡ºåºä¸²è¡Œæ‰§è¡Œï¼Œä½¿ç”¨barriersæ²¡æœ‰ä»»ä½•å¥½å¤„ã€‚ä¸€èˆ¬æ¥è®²æˆ‘ä»¬ä¸éœ€è¦è¿™ä¹ˆåšã€‚</p>
</li>
<li><p>Global Concurrent Queue: è¿™é‡Œè™½ç„¶æ˜¯å¹¶è¡Œé˜Ÿåˆ—ï¼Œä½†è¿™ä¸ªé˜Ÿåˆ—æ˜¯å…¨å±€çš„ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿è¯åˆ«äººæ²¡æœ‰ä½¿ç”¨è¿™ä¸ªé˜Ÿåˆ—ã€‚å¯¹è¿™ä¸ªé˜Ÿåˆ—åŠ barriersï¼Œå¯èƒ½ä¼šå½±å“åˆ°å…¶ä»–æ¨¡å—çš„åŠŸèƒ½ã€‚æ‰€ä»¥ä¸å»ºè®®åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸­ä½¿ç”¨ã€‚</p>
</li>
<li><p>Custom Concurrent Queue: åœ¨è‡ªå®šä¹‰çš„å¹¶è¡Œé˜Ÿåˆ—ä¸­ä½¿ç”¨barriersï¼Œæ˜¯æ¯”è¾ƒåˆé€‚çš„æ–¹å¼ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥å½“æˆ‘ä»¬è¦åšçš„å¹¶è¡Œæ“ä½œï¼Œå¯èƒ½å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ—¶å€™ã€‚æˆ‘ä»¬æœ€å¥½è€ƒè™‘æ–°å»ºè‡ªå®šä¹‰å¹¶è¡Œé˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ç®€å•åœ°ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ Global Queueã€‚</p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æŸä¸€ä¸ªç±»è¦ç®¡ç†MyClassè¿™ä¸ªç±»å‹çš„è¯»å†™ï¼Œä¸‹é¢åˆ—ä¸¾è¿™ä¸ªç±»çš„ä¸€äº›ç›¸å…³æ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//åˆå§‹åŒ–è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—</span><br><span class="line">- (instancetype)init&#123;</span><br><span class="line">  	</span><br><span class="line">	if(self = [super init])&#123;</span><br><span class="line">		customConcurrentQueue = dispatch_queue_create(&quot;com.customConcurrentQueue&quot;, DISPATCH_QUEUE_CONCURRENT); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å†™æ–¹æ³•</span><br><span class="line">- (void)write:(MyClass *)myClass &#123;</span><br><span class="line"></span><br><span class="line">	if( myClass )&#123;</span><br><span class="line">		</span><br><span class="line">		//ä½¿ç”¨barrierï¼Œä¿è¯å†™æ–¹æ³•ï¼Œå¯ä»¥ä¸²è¡Œæ‰§è¡Œ</span><br><span class="line">           dispatch_barrier_async(self.customConcurrentQueue, ^&#123; </span><br><span class="line">           	</span><br><span class="line">           	//å†™æ“ä½œ</span><br><span class="line">           	...</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//è¯»æ–¹æ³•</span><br><span class="line">- (MyClass *)read&#123;</span><br><span class="line">	</span><br><span class="line">	//è¦ä¿è¯ï¼Œè¯»å’Œå†™æ–¹æ³•ä¸èƒ½åŒæ—¶æ‰§è¡Œï¼Œ</span><br><span class="line">	//é¦–å…ˆï¼Œä»–ä»¬è¦åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ ï¼šself.customConcurrentQueue</span><br><span class="line">	//å…¶æ¬¡ï¼Œè¯»æ–¹æ³•è¦ç­‰å¾…è¯»å‡ºæ•°æ®åè¿”å›ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯åŒæ­¥æ“ä½œ ï¼šdispatch_sync</span><br><span class="line">	</span><br><span class="line">	__block MyClass *myClass = [[MyClass alloc] init];</span><br><span class="line">	</span><br><span class="line">	dispatch_sync(self.customConcurrentQueue, ^&#123;</span><br><span class="line">	</span><br><span class="line">		//è¯»æ“ä½œ</span><br><span class="line">		myClass = ...</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	return myClass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="dispatch-groups"><a href="#dispatch-groups" class="headerlink" title="dispatch groups"></a>dispatch groups</h2><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªå¹¶è¡Œä»»åŠ¡å…¨éƒ¨å®Œæˆåï¼Œåšä¸€äº›æ“ä½œï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ° groupæ¥ç®¡ç†äº†ã€‚</p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚æˆ‘æœ‰4ä¸ªä»»åŠ¡è¦ä½¿ç”¨å¹¶å‘å¤„ç†ï¼Œä»»åŠ¡4è¦ç­‰å¾…ï¼Œä»»åŠ¡1ã€2ã€3å®Œæˆåæ‰§è¡Œã€‚åŒæ—¶ï¼Œä»»åŠ¡4ä¸é˜»å¡å½“å‰çš„çº¿ç¨‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (void)testDispatchGroup&#123;</span><br><span class="line"></span><br><span class="line">	dispatch_queue_t concurrentQueue = dispatch_queue_create(&quot;com.test.testConcurrent&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">	dispatch_group_t group = dispatch_group_create();</span><br><span class="line"></span><br><span class="line">	//å¼‚æ­¥æ“ä½œ</span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	ä»»åŠ¡1</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	ä»»åŠ¡2</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	ä»»åŠ¡3</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	//dispatch_group_notify ä¸­çš„blockæ‰§è¡Œçš„æ˜¯æˆ‘ä»¬æœ€åè¦åšçš„ä»»åŠ¡ã€‚åŒæ—¶ï¼Œè¿™é‡Œæ˜¯å¼‚æ­¥æ“ä½œï¼Œä¸ä¼šé˜»å¡åé¢å…¶ä»–ä»£ç çš„æ‰§è¡Œã€‚</span><br><span class="line">	dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">		</span><br><span class="line">		//å‰é¢3ä¸ªä»»åŠ¡ï¼Œéƒ½æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œé‡Œé¢çš„block</span><br><span class="line">		ä»»åŠ¡4</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">    	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†çœ‹å¦ä¸€ä¸ªéœ€æ±‚ï¼Œè¿˜æ˜¯ä¹‹å‰çš„4ä¸ªä»»åŠ¡ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œä»»åŠ¡4é™¤äº†è¦ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆï¼Œè¿˜è¦é˜»å¡å½“å‰çº¿ç¨‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (void)testDispatchGroup&#123;</span><br><span class="line"></span><br><span class="line">	dispatch_group_t group = dispatch_group_create();</span><br><span class="line"></span><br><span class="line">	//å¼‚æ­¥æ“ä½œ</span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	ä»»åŠ¡1</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	ä»»åŠ¡2</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">	       </span><br><span class="line">    	ä»»åŠ¡3</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	//dispatch_group_wait ç­‰å¾…ä¸Šé¢ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¶…è¿‡è®¾ç½®çš„æ—¶é—´</span><br><span class="line">	//ä½¿ç”¨æ—¶ï¼Œè¦æ³¨æ„é¿å…é˜»å¡ä¸»çº¿ç¨‹ç­‰é—®é¢˜</span><br><span class="line">	dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</span><br><span class="line">	</span><br><span class="line">	ä»»åŠ¡4</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œé™¤äº†ä½¿ç”¨dispatch_group_asyncç®¡ç†è¦åšçš„ä»»åŠ¡ã€‚è¿˜å¯ä»¥ä½¿ç”¨<code>dispatch_group_enter</code>ã€ <code>dispatch_group_leave</code> ç»„åˆçš„æ–¹å¼ï¼Œæ‰‹åŠ¨é€šçŸ¥ä»»åŠ¡å®Œæˆã€‚å¦‚æœä½¿ç”¨æ‰‹åŠ¨ç®¡ç†çš„è¯ï¼Œæˆ‘ä»¬è¦æ³¨æ„ï¼š<code>enterå’Œleaveæ–¹æ³•ï¼Œåº”è¯¥æ˜¯æˆå¯¹å‡ºç°çš„</code>ã€‚</p>
<p>dispatch_group_enter(customGroup) : æ‰‹åŠ¨å‘ŠçŸ¥customGroupï¼Œè¡¨ç¤ºä¸€ä¸ªä»»åŠ¡å·²ç»å¼€å§‹æ‰§è¡Œã€‚ </p>
<p>dispatch_group_leave(customGroup) : æ‰‹åŠ¨å‘ŠçŸ¥customGroupï¼Œè¡¨ç¤ºä¸€ä¸ªä»»åŠ¡å·²ç»å®Œæˆã€‚å½“æ‰€æœ‰enterå¯¹åº”çš„leaveæ–¹æ³•éƒ½æ‰§è¡Œè¿‡åã€‚æˆ‘ä»¬çš„<code>dispatch_group_notify()</code>æˆ–è€…<code>dispatch_group_wait()</code>ï¼Œå°±å¯ä»¥æ¥åˆ°ä»»åŠ¡å®Œæˆçš„é€šçŸ¥ã€‚</p>
<hr>
<h2 id="dispatch-semaphore-ä¿¡å·é‡"><a href="#dispatch-semaphore-ä¿¡å·é‡" class="headerlink" title="dispatch semaphore ä¿¡å·é‡"></a>dispatch semaphore ä¿¡å·é‡</h2><p>å½“æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œè®¿é—®æœ‰é™çš„èµ„æºçš„æ—¶å€™ï¼Œ<a href="https://en.wikipedia.org/wiki/Semaphore_(programming\" target="_blank" rel="noopener">ä¿¡å·é‡</a>) å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½çš„æ§åˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡å¯¹ä¿¡å·ä¸ªæ•°çš„æ§åˆ¶ï¼Œæ¥è¾¾åˆ°çº¿ç¨‹é—´çš„åŒæ­¥æ“ä½œã€‚å½“ä¿¡å·ä¸ªæ•°ä¸º0çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹è¢«é˜»å¡ï¼Œç­‰å¾…ä¿¡å·é‡å¢åŠ ï¼Œå½“ä¿¡å·é‡ä¸ªæ•°å¤§äº0çš„æ—¶å€™ï¼Œåˆ™çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚ </p>
<p>æ³¨æ„ï¼ŒåŒæ­¥çš„æ“ä½œéƒ½è¦å°å¿ƒä½¿ç”¨ï¼Œé¿å…æ­»é”ç­‰é—®é¢˜ã€‚</p>
<p>å¦å¤–ï¼Œæ ¹æ®dispatch_semaphore_waitçš„è¿”å›å€¼ï¼Œå¯ä»¥ç”¨äºåˆ¤æ–­æŸä»»åŠ¡æ˜¯å¦è¶…æ—¶æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void)testSemaphore&#123;</span><br><span class="line"></span><br><span class="line">	//åˆ›å»º ä¿¡å·é‡ å‚æ•°ä»£è¡¨åˆå§‹ä¸ªæ•°</span><br><span class="line">	dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">	</span><br><span class="line">		sleep(2);</span><br><span class="line">	</span><br><span class="line">		//å‘é€ä¸€ä¸ªä¿¡å·ï¼Œä¿¡å·é‡ä¸ªæ•° +1	</span><br><span class="line">		dispatch_semaphore_signal(semaphore);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">	</span><br><span class="line">		dispatch_time_t timeoutTime = dispatch_time(DISPATCH_TIME_NOW, 1 * NSEC_PER_SEC);</span><br><span class="line">	</span><br><span class="line">		//çº¿ç¨‹ç­‰å¾…ï¼Œå½“ä¿¡å·é‡å¤§äº0æ—¶ ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œä¿¡å·é‡ -1</span><br><span class="line">		//çº¿ç¨‹ç­‰å¾…ï¼Œè¶…è¿‡é¢„å®šçš„è¶…æ—¶æ—¶é—´ ä»»åŠ¡ç»§ç»­æ‰§è¡Œ ä¿¡å·é‡ä¸å˜</span><br><span class="line">		//å…³äºè¿”å›å€¼ï¼šå½“è¿”å›å€¼ ä¸ä¸º0 çš„æ—¶å€™ï¼Œè¯´æ˜è¶…æ—¶</span><br><span class="line">		if( dispatch_semaphore_wait(semaphore, timeoutTime) )&#123;</span><br><span class="line">			NSLog(@&quot;time out&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/14/2015-12-14-gcd-part-1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/14/2015-12-14-gcd-part-1/" itemprop="url">GCD åŒæ­¥ä¸å¼‚æ­¥ ä¸²è¡Œä¸å¹¶è¡Œ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-14T15:25:27+08:00">
                2015-12-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/12/14/2015-12-14-gcd-part-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/12/14/2015-12-14-gcd-part-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>GCDæ˜¯iOSå¼€å‘å¤šçº¿ç¨‹ä¸­ç»å¸¸ä½¿ç”¨çš„æŠ€æœ¯ï¼Œå…ˆçœ‹ä¸€ä¸‹GCDä¸­çš„å¸¸è§çš„æœ¯è¯­</p>
<p>æè¿°å¤šä¸ªä»»åŠ¡ä¹‹é—´åŒä¸€æ—¶åˆ»çš„è¿è¡Œå…³ç³»ï¼š</p>
<ul>
<li>serialï¼ˆä¸²è¡Œï¼‰ æŸä¸€æ—¶åˆ»ï¼Œåªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡</li>
<li>concurrentï¼ˆå¹¶è¡Œï¼‰ å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡</li>
</ul>
<p>ä¾§é‡æè¿°ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œå®Œæˆï¼Œå¯¹å…¶ä»–ä»»åŠ¡çš„å½±å“ (æ—¢ æ˜¯å¦ä»»åŠ¡åœ¨ç­‰å¾…æŸä¸ªå‡½æ•°å®Œæˆï¼Œç„¶åæ‰å¯ä»¥è¿è¡Œ)ï¼š</p>
<ul>
<li>synchronousï¼ˆåŒæ­¥ï¼‰ ä»»åŠ¡æ‰§è¡Œå®Œæˆåretureï¼Œï¼ˆé˜»å¡ï¼‰</li>
<li>asynchronousï¼ˆå¼‚æ­¥ï¼‰ ä¸ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œç«‹å³retureï¼Œï¼ˆä¸é˜»å¡å½“å‰ï¼‰</li>
</ul>
<p>åœ¨GCDä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸²è¡Œå¹¶è¡Œæè¿°é˜Ÿåˆ—ã€‚è¿™å°±æ˜¯åœ¨æè¿°ï¼Œè¯¥é˜Ÿåˆ—é‡Œé¢çš„æ‰€æœ‰ä»»åŠ¡ï¼Œç›¸äº’ä¹‹é—´åœ¨åŒä¸€æ—¶åˆ»ï¼Œæ˜¯æ€æ ·çš„è¿è¡Œå…³ç³»ã€‚æ˜¯æŒ‡é˜Ÿåˆ—å†…æœ¬èº«çš„ä»»åŠ¡è¿è¡Œé¡ºåºã€‚<br>æˆ‘ä»¬è¿˜ç”¨åŒæ­¥å¼‚æ­¥ï¼Œæè¿°æŸä¸€ä¸ªä»»åŠ¡ã€‚æ¯”å¦‚è¯´ä»»åŠ¡Aæ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚è¿™å°±æ˜¯åœ¨è¯´ï¼ŒAä»»åŠ¡ï¼Œä¼šé˜»å¡å½“å‰ä»»åŠ¡ï¼Œç›´åˆ°Aç»“æŸã€‚è¿™æ˜¯æŒ‡ä¸åŒä»»åŠ¡ä¹‹é—´çš„å…³ç³»ï¼Œä¸é˜Ÿåˆ—æ— å…³ï¼Œå¯ä»¥æ˜¯ä¸åŒé˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸åŒé˜Ÿåˆ—ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ï¼ŒGCDé‡Œé¢çš„ä¸åŒé˜Ÿåˆ—ã€‚</p>
<hr>
<h2 id="Serial-Queues"><a href="#Serial-Queues" class="headerlink" title="Serial Queues"></a>Serial Queues</h2><p>åœ¨ä¸²è¡Œé˜Ÿåˆ—é‡Œï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä»»åŠ¡æŒ‰ç…§è¢«æ·»åŠ è¿›å…¥é˜Ÿåˆ—çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚æ¯ä¸€ä¸ªä»»åŠ¡åªæœ‰åœ¨å‰é¢çš„ä»»åŠ¡å®Œæˆåï¼Œæ‰å¯ä»¥å¼€å§‹æ‰§è¡Œã€‚</p>
<p>ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„ä¸²è¡Œé˜Ÿåˆ—</p>
<ul>
<li><p>main queue ( dispatch_get_main_queue )</p>
<p>  main queueæ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œæœ‰ä¸²è¡Œé˜Ÿåˆ—çš„ä¸€åˆ‡ç‰¹æ€§ã€‚æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ç‚¹æ˜¯åŠ å…¥è¿™ä¸ªé˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ã€‚</p>
</li>
</ul>
<h2 id="Concurrent-Queues"><a href="#Concurrent-Queues" class="headerlink" title="Concurrent Queues"></a>Concurrent Queues</h2><p>åŠ å…¥å¹¶è¡Œé˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œæ‰§è¡Œçš„é¡ºåºä¹Ÿæ˜¯æŒ‰ç…§ä»»åŠ¡è¢«åŠ å…¥é˜Ÿåˆ—çš„é¡ºåºæ‰§è¡Œï¼Œè¿™æ˜¯æˆ‘ä»¬å”¯ä¸€å¯ä»¥ä¿è¯çš„ã€‚æ¯ä¸ªä»»åŠ¡éƒ½ä¸ç”¨ç­‰å¾…ä¹‹å‰çš„ä»»åŠ¡å®Œæˆï¼ŒåŒä¸€æ—¶åˆ»å¯ä»¥å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œã€‚</p>
<p>ç³»ç»ŸåŒæ ·æœ‰ä¸€ä¸ªå…¨å±€çš„å¹¶å‘é˜Ÿåˆ—</p>
<ul>
<li><p>global dispatch queue ( dispatch_get_global_queue )</p>
<p>  è¿™æ˜¯å¦ä¸€ä¸ªæˆ‘ä»¬ç†Ÿæ‚‰çš„å¹¶å‘é˜Ÿåˆ—ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç›´æ¥ä½¿ç”¨è¿™ä¸ªé˜Ÿåˆ—ï¼Œå¯ä»¥ç®€å•å¤„ç†ä¸€äº›æˆ‘ä»¬éœ€è¦å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>
</li>
</ul>
<h2 id="Custom-Queue"><a href="#Custom-Queue" class="headerlink" title="Custom Queue"></a>Custom Queue</h2><p>é™¤äº†ç³»ç»Ÿæä¾›çš„å…¨å±€é˜Ÿåˆ—ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ä¸²è¡Œæˆ–è€…å¹¶è¡Œçš„é˜Ÿåˆ—ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dispatch_queue_t mySerialQueue = dispatch_queue_create(&quot;com.mySerialQueue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line">   dispatch_queue_t myConcurrentQueue = dispatch_queue_create(&quot;com.myConcurrentQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯å‡ ç§æˆ‘ä»¬ç”¨GCDæ—¶ï¼Œéœ€è¦ä½¿ç”¨åˆ°çš„é˜Ÿåˆ—ã€‚</p>
<p>å¦å¤–ï¼Œä½¿ç”¨GCDï¼Œé™¤äº†é€‰æ‹©æ­£ç¡®çš„é˜Ÿåˆ—å¤–ï¼Œè¿˜è¦å…³æ³¨ï¼šæˆ‘ä»¬è¦æ‰§è¡Œçš„ä»»åŠ¡æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥æ‰§è¡Œã€‚</p>
<!--
åŒæ­¥æ‰§è¡Œ ä¸²è¡Œqueue 
        å¹¶è¡Œqueue

å¼‚æ­¥æ‰§è¡Œ ä¸²è¡Œqueue 
        å¹¶è¡Œqueue
-->
<hr>
<h2 id="dispatch-async-å¼‚æ­¥æ‰§è¡Œ"><a href="#dispatch-async-å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="dispatch_async  å¼‚æ­¥æ‰§è¡Œ"></a>dispatch_async  å¼‚æ­¥æ‰§è¡Œ</h2><p>dispatch_async ç”¨æ¥ç”¨å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œä¸²è¡Œæˆ–è€…å¹¶è¡Œé˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨ dispatch_async çš„å‡ ç§å¸¸è§æƒ…å†µï¼š</p>
<ul>
<li>custom Serial Queueï¼šå½“æˆ‘ä»¬éœ€è¦æ‰§è¡Œå‡ ä¸ªåº”è¯¥ä¸²è¡Œæ‰§è¡Œçš„ä»»åŠ¡ï¼Œåˆä¸é˜»å¡å½“å‰çš„æ—¶å€™ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// task1 task2 é¡ºåºä¾æ¬¡æ‰§è¡Œï¼ŒåŒæ—¶ä¸é˜»å¡others</span><br><span class="line"></span><br><span class="line">   dispatch_queue_t mySerialQueue = dispatch_queue_create(&quot;com.mySerialQueue&quot;, NULL);</span><br><span class="line">   </span><br><span class="line">   dispatch_async(mySerialQueue, ^&#123;</span><br><span class="line">      ...task1</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   dispatch_async(mySerialQueue, ^&#123;</span><br><span class="line">	...task2</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   ...others</span><br></pre></td></tr></table></figure>
<ul>
<li><p>main Queueï¼šå½“æˆ‘ä»¬æ‰§è¡Œå¹¶å®Œæˆäº†ä¸€æ®µå¼‚æ­¥çš„ä»»åŠ¡ï¼Œéœ€è¦å›åˆ°ä¸»çº¿ç¨‹æ›´æ–°UIçš„æ—¶å€™ï¼Œå¾ˆå¸¸è§çš„é€‰æ‹©å°±æ˜¯ä½¿ç”¨GCDçš„ main queueã€‚</p>
</li>
<li><p>custom or global concurrent Queueï¼šè¿™ä¸ªæ˜¯æˆ‘ä»¬æ‰§è¡ŒéUIä»»åŠ¡çš„å¸¸è§é€‰æ‹©ã€‚è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠ å…¥é˜Ÿåˆ—çš„å¤šä¸ªä»»åŠ¡ä¹‹é—´å¹¶å‘æ‰§è¡Œï¼Œæˆ‘ä»¬æ— æ³•çŸ¥é“é‚£ä¸ªä»»åŠ¡å…ˆå®Œæˆã€‚</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">dispatch_queue_t myConcurrentQueue = dispatch_queue_create(&quot;com.myConcurrentQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">dispatch_async(myConcurrentQueue, ^&#123;</span><br><span class="line">	</span><br><span class="line">	...task1    </span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">       	Update UI </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="dispatch-sync-åŒæ­¥æ‰§è¡Œ"><a href="#dispatch-sync-åŒæ­¥æ‰§è¡Œ" class="headerlink" title="dispatch_sync åŒæ­¥æ‰§è¡Œ"></a>dispatch_sync åŒæ­¥æ‰§è¡Œ</h2><p>å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬æ‰§è¡Œdispatch_syncæ“ä½œï¼Œéƒ½è¦æ ¼å¤–å°å¿ƒäº›ã€‚</p>
<ul>
<li>custom or main Serial Queueï¼š åŒæ­¥æ‰§è¡Œä¸²è¡Œé˜Ÿåˆ—æ—¶ï¼Œè¦æ³¨æ„é˜²æ­¢å‘ç”Ÿæ­»é”ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//ä¸²è¡Œé˜Ÿåˆ—ä¸­ï¼Œtask2 ç­‰å¾… task1å®Œæˆï¼Œæ‰€ä»¥ä¸ä¼šå¼€å§‹ã€‚è€Œtask1åˆå®Œæˆä¸äº†ï¼Œå› ä¸ºtask2è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ(ç”šè‡³éƒ½æ²¡æœ‰å¼€å§‹)ã€‚æ­»é”ã€‚</span><br><span class="line">	</span><br><span class="line">    dispatch_queue_t mySerialQueue = dispatch_queue_create(&quot;com.mySerialQueue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    dispatch_sync(mySerialQueue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        ...task1</span><br><span class="line">        dispatch_sync(mySerialQueue, ^&#123;</span><br><span class="line">        	 </span><br><span class="line">        	 ...task2        	 </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>concurrent Queueï¼šåˆç†ä½¿ç”¨å¯ä»¥è§£å†³ä¸€äº›å¹¶å‘è¯»å†™é—®é¢˜ã€‚ä¾‹å¦‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//task1 æ‰§è¡Œç»“æŸåï¼Œtask2æ‰ä¼šå¼€å§‹æ‰§è¡Œã€‚</span><br><span class="line">    dispatch_queue_t myConcurrentQueue = dispatch_queue_create(&quot;com.myConcurrentQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">    dispatch_sync(myConcurrentQueue, ^&#123;</span><br><span class="line">        </span><br><span class="line">		...task1 è¯»</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_async(myConcurrentQueue, ^&#123;</span><br><span class="line">        </span><br><span class="line">		...task2 å†™</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="dispatch-after"><a href="#dispatch-after" class="headerlink" title="dispatch_after"></a>dispatch_after</h2><p>å¼‚æ­¥å»¶è¿Ÿæ“ä½œã€‚å®é™…ä¸Š dispatch_after å°±åƒä¸€ä¸ªå»¶è¿Ÿæ‰§è¡Œçš„ dispatch_asyncã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">double delayInSeconds = 1.0;</span><br><span class="line">   dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delayInSeconds * NSEC_PER_SEC));</span><br><span class="line">    dispatch_after(popTime, dispatch_get_main_queue(), ^(void)&#123;</span><br><span class="line"></span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/11/2015-11-11-helloreactnative/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/11/2015-11-11-helloreactnative/" itemprop="url">Hello ReactNative</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-11-11T16:09:23+08:00">
                2015-11-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/11/2015-11-11-helloreactnative/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/11/2015-11-11-helloreactnative/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è™½ç„¶å¾ˆå¤šå¼€å‘è€…éƒ½æ˜¯ä¸€ç›´ä½¿ç”¨Ocå’ŒSwiftå¼€å‘iOSåº”ç”¨ï¼Œä½†ä¸å¾—ä¸è¯´ReactNativeçš„â€™learn-once write-anywhereâ€™ï¼Œå¯¹å¼€å‘è€…è¿˜æ˜¯æœ‰å¼ºå¤§çš„å¸å¼•åŠ›çš„ã€‚ç”¨Jså†™é€»è¾‘ï¼Œå¹¶ä¸”ä½¿ç”¨åŸç”Ÿçš„UIï¼Œä¸ä¾æ‰˜äºæµè§ˆå™¨ï¼Œå¦‚ä»Šçš„Jsè¶Šæ¥è¶Šå¼ºå¤§ã€‚å³ä¾¿æ˜¯ä½¿ç”¨åŸç”Ÿè¯­è¨€çš„å¼€å‘è€…ï¼Œä¹Ÿåº”è¯¥è¯¦ç»†äº†è§£ä¸‹ã€‚</p>
<h3 id="é…ç½®-React-Native"><a href="#é…ç½®-React-Native" class="headerlink" title="é…ç½® React Native"></a>é…ç½® React Native</h3><p>è¦æƒ³åœ¨é¡¹ç›®ä¸­ä½¿ç”¨<a href="https://facebook.github.io/react-native/docs/getting-started.html#content" target="_blank" rel="noopener">ReactNative</a>ï¼Œéœ€è¦å…ˆæ­å»ºNode.jsç¯å¢ƒã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨nvmï¼Œä¸‹è½½ç®¡ç†Node.jsã€‚</p>
<ul>
<li>nvm</li>
</ul>
<p>å®˜æ–¹å®‰è£…å’Œä½¿ç”¨ nvm çš„<a href="https://github.com/creationix/nvm#installation" target="_blank" rel="noopener">æ­¥éª¤</a>ã€‚ç®€å•æ•´ç†ä¸‹ï¼š</p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  	curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.30.2/install.sh | bash</span><br><span class="line"></span><br><span class="line">sh ~/.nvm/nvm.sh</span><br></pre></td></tr></table></figure>
<p>æŠŠä¸‹é¢çš„å†…å®¹è¿½åŠ åˆ° <code>~/.bashrc</code> å’Œ <code>~/.profile</code> ä¸­</p>
<p>ä¾‹å¦‚ï¼švim ~/.bashrc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.nvm/nvm.sh</span><br></pre></td></tr></table></figure>
<p>å®Œæˆåé‡å¯ç»ˆç«¯</p>
<p>ä½¿ç”¨nvmä¸‹è½½Nodeï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//æŸ¥çœ‹æ”¯æŒç‰ˆæœ¬</span><br><span class="line">nvm ls-remote</span><br><span class="line">	</span><br><span class="line">nvm install v5.5.0</span><br><span class="line"></span><br><span class="line">nvm use v5.5.0</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ç›´æ¥ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Node</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install node &amp;&amp; nvm alias default node</span><br></pre></td></tr></table></figure>
<ul>
<li>å®‰è£…watchman</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install watchman</span><br></pre></td></tr></table></figure>
<ul>
<li>å®‰è£… React Native CLI tool</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g react-native-cli</span><br></pre></td></tr></table></figure>
<p>å‡†å¤‡å·¥ä½œåŸºæœ¬ç»“æŸ</p>
<hr>
<h3 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h3><p>ä¸‹é¢æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªç›®å½•ï¼Œæ–°å»ºä¸€ä¸ªReactNativeé¡¹ç›®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native init HelloReactNative</span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°index.ios.jsï¼Œæ›¿æ¢ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ã€‚æ‰¾åˆ°iOSæ–‡ä»¶å¤¹ä¸‹é¢çš„å·¥ç¨‹ï¼Œè¿è¡Œä¸€ä¸‹ï¼Œä¸€ä¸ªç®€å•ç”¨ReactNativeå®ç°çš„helloworldç¨‹åºï¼Œå°±å¯ä»¥è·‘èµ·æ¥äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var React = require(&apos;react-native&apos;);</span><br><span class="line"></span><br><span class="line">var styles = React.StyleSheet.create(&#123;</span><br><span class="line">  text: &#123;</span><br><span class="line">    color: &apos;black&apos;,</span><br><span class="line">    backgroundColor: &apos;white&apos;,</span><br><span class="line">    fontSize: 30,</span><br><span class="line">    margin: 80</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// for app itself</span><br><span class="line">class ReactNativeDemoApp extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return React.createElement(React.Text, &#123;style: styles.text&#125;, &quot;Hello World&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">React.AppRegistry.registerComponent(&apos;HelloReactNative&apos;, () =&gt; ReactNativeDemoApp);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/09/30/2015-09-30-guan-yu-nsoperation/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/thumbnail.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrBoog Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/09/30/2015-09-30-guan-yu-nsoperation/" itemprop="url">NSOperation</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-09-30T17:56:07+08:00">
                2015-09-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/09/30/2015-09-30-guan-yu-nsoperation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/09/30/2015-09-30-guan-yu-nsoperation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>NSOperation æ˜¯ abstract class æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸€èˆ¬è¦å­ç±»åŒ–ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ä¸¤ä¸ªå­ç±»ï¼š</p>
<ul>
<li>NSInvocationOperation</li>
<li>NSBlockOperation</li>
</ul>
<p>è™½ç„¶GCDä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†ä½¿ç”¨ä¸å½“ä¹Ÿä¼šæš´éœ²ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å¯¹ä»»åŠ¡çŠ¶æ€çš„ä¸å¥½æ§åˆ¶ç­‰ã€‚è¿™å¯èƒ½å¯¼è‡´æœ‰äº›æˆ‘ä»¬æœ¬æ¥éœ€è¦å–æ¶ˆæ‰çš„ä»»åŠ¡ï¼Œä¸€ç›´åœ¨è¿è¡Œï¼Œå ç”¨èµ„æºã€‚è¿™äº›æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è€ƒè™‘é€šè¿‡ NSOperationQueue åŠ å¼ºå¯¹ä»»åŠ¡çš„æ§åˆ¶ã€‚</p>
<hr>
<h4 id="NSInvocationOperation"><a href="#NSInvocationOperation" class="headerlink" title="NSInvocationOperation"></a>NSInvocationOperation</h4><p>NSInvocationOperationæ˜¯æŠ½è±¡ç±»NSOperationçš„å®ä½“å­ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å¦‚æœä¸ç»“åˆNSOperationQueueï¼Œå•ç‹¬é€šè¿‡è°ƒç”¨ startæ–¹æ³•ä½¿ç”¨ï¼ŒNSInvocationOperationæ˜¯éå¹¶å‘çš„æ“ä½œã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   // é€šè¿‡ start ç›´æ¥è°ƒç”¨ï¼Œä»»åŠ¡å°†åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</span><br><span class="line">   NSInvocationOperation *invocationOp = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(doSomeThingWithInvocation:) object:nil];</span><br><span class="line">   [invocationOp start];</span><br><span class="line"></span><br><span class="line">// æˆ–è€…é€šè¿‡ addOperation å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ï¼Œå¯åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ</span><br><span class="line">myOperationQueue = [[NSOperationQueue alloc] init];</span><br><span class="line">[myOperationQueue addOperation:invocationOp];</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œåœ¨swiftä¸­,NSInvocationç›¸å…³çš„ç±»ï¼Œéƒ½å·²ç»å»æ‰äº†(ä¸çŸ¥é“ä»¥åä¼šä¸ä¼šåŠ å…¥)ï¼Œä¹Ÿè®¸NSInvocationOperationä¹Ÿæ˜¯é€€å‡ºå†å²èˆå°çš„èŠ‚å¥ã€‚</p>
<hr>
<h4 id="NSBlockOperation"><a href="#NSBlockOperation" class="headerlink" title="NSBlockOperation"></a>NSBlockOperation</h4><p>NSBlockOperationä¹Ÿæ˜¯NSOperationçš„å­ç±»ï¼Œåªæ˜¯è·ŸNSInvocationOperationä½¿ç”¨NSInvocationä¸åŒï¼ŒNSBlockOperationä½¿ç”¨blockï¼Œä½¿ç”¨èµ·æ¥ä¼šæ›´æ–¹ä¾¿ã€‚        </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">myOperationQueue = [[NSOperationQueue alloc] init];	  	   </span><br><span class="line">NSBlockOperation *blockOp = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">       //éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="line">   &#125;];</span><br><span class="line">   </span><br><span class="line">   [blockOp addExecutionBlock:^&#123;</span><br><span class="line">       //éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="line">   &#125;];</span><br><span class="line">   </span><br><span class="line">   // finishedå±æ€§ä¸ºYESå(å®Œæˆæˆ–è€…è¢«å–æ¶ˆ)å°†ä¼šæ‰§è¡Œ</span><br><span class="line">   __weak NSBlockOperation *weakOp = blockOp;</span><br><span class="line">   [blockOp setCompletionBlock:^&#123;</span><br><span class="line">	</span><br><span class="line">	if (!weakOp.isCancelled) &#123;</span><br><span class="line">	</span><br><span class="line">		[[NSOperationQueue mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line">        	//æ›´æ–°ä¸»çº¿ç¨‹</span><br><span class="line">   	    &#125;];			</span><br><span class="line">	&#125;</span><br><span class="line">   &#125;];</span><br><span class="line"></span><br><span class="line">[myOperationQueue addOperation:blockOp];</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ï¼Œblockç›¸äº’ä¹‹é—´éƒ½æ˜¯å¹¶è¡Œå¼‚æ­¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªblockï¼Œä¸åŒblockä¹‹é—´ä¸ä¼šç›¸äº’é˜»å¡ã€‚ä¸ç”¨ç­‰å¾…ä¾èµ–å…¶ä»–blockå®Œæˆã€‚blockå†…éƒ¨æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚ </p>
<p>é€šè¿‡æ·»åŠ ä¾èµ–ï¼Œæ¥æ§åˆ¶ä¸åŒçš„NSBlockOperationä¹‹é—´æ˜¯å¦å®Œå…¨å¹¶è¡Œæ‰§è¡Œã€‚æ³¨æ„ä¸è¦å¾ªç¯ä¾èµ–å¯¼è‡´æ­»é”ã€‚    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">NSBlockOperation *blockOp2 = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">	//éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="line">   &#125;];</span><br><span class="line">   </span><br><span class="line">   //blockOp2 å°†ç­‰å¾…è‡³ blockOp ç»“æŸåï¼Œå¼€å§‹æ‰§è¡Œ</span><br><span class="line">   [blockOp2 addDependency:blockOp];</span><br><span class="line">[myOperationQueue addOperation:blockOp2];</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="å­ç±»åŒ–è‡ªå®šä¹‰NSOperation"><a href="#å­ç±»åŒ–è‡ªå®šä¹‰NSOperation" class="headerlink" title="å­ç±»åŒ–è‡ªå®šä¹‰NSOperation"></a>å­ç±»åŒ–è‡ªå®šä¹‰NSOperation</h4><p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©é‡å†™ <code>main</code> æ–¹æ³•ï¼Œæˆ–è€… <code>start</code> æ–¹æ³•ï¼Œæ¥å®ç°ã€‚</p>
<ul>
<li>mainï¼šé‡å†™mainæ–¹æ³•ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†å¤ªå¤šçŠ¶æ€ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void)main &#123;</span><br><span class="line">   	@autoreleasepool &#123;</span><br><span class="line"></span><br><span class="line">		//åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¦é¢‘ç¹çš„æ£€æµ‹ isCancelled å±æ€§</span><br><span class="line">		if(self.isCancelled)&#123;</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>startï¼šæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šé‡å†™startï¼Œç›¸å¯¹äºé‡å†™mainæ–¹æ³•ï¼Œå¤„ç†ä¸Šè¦æ›´å¤æ‚äº›ã€‚è¦è‡ªå·±æ³¨æ„ä»»åŠ¡çš„ä¸€äº›çŠ¶æ€æ¯”å¦‚isExecutingï¼ŒisFinishedï¼ŒisConcurrent(isAsynchronous)ï¼ŒisReadyã€‚æ³¨æ„ï¼Œå½“å®ç°äº†startï¼Œå°±ä¸ä¼šæ‰§è¡Œmainã€‚</li>
</ul>
<ul>
<li>dependencyï¼šä»»åŠ¡ä¹‹é—´æ·»åŠ ä¾èµ–ã€‚æœ‰æ—¶å€™æŸä¸€ä¸ªä»»åŠ¡ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–ä»»åŠ¡çš„ç»“æŸåæ‰èƒ½å¼€å§‹ã€‚è¿™æ—¶å€™ï¼Œç›¸å¯¹äºä½¿ç”¨GCDçš„dispatch_barrier_asyncæ›´å®¹æ˜“ç†è§£ä¸€äº›ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//åœ¨op2çš„ä»»åŠ¡å°šæœªæ‰§è¡Œæ—¶ï¼Œæ·»åŠ ä¾èµ–ï¼Œop2å°†ç­‰å¾…ç›´åˆ°opå®Œæˆ</span><br><span class="line">[op2 addDependency:op];</span><br><span class="line">//ç§»å‡ºop2çš„ä¾èµ–</span><br><span class="line">[op2 removeDependency:op];</span><br></pre></td></tr></table></figure>
<ul>
<li>Completion blockï¼šä»»åŠ¡å®Œæˆåçš„å›è°ƒï¼Œè¦æ³¨æ„æ­¤æ—¶å¹¶æ²¡æœ‰å›åˆ°ä¸»çº¿ç¨‹ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">__weak NSBlockOperation *weakOp = blockOp;</span><br><span class="line">[blockOp setCompletionBlock:^&#123;</span><br><span class="line">    </span><br><span class="line">    if ( !weakOp.isCancelled ) &#123;</span><br><span class="line">        [[NSOperationQueue mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line"></span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>å¦å¤–æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li><p>å·²ç»å®Œæˆçš„ä»»åŠ¡ï¼Œä¸èƒ½è¢«é‡æ–°æ‰§è¡Œã€‚    </p>
</li>
<li><p>å·²ç»æ·»åŠ åˆ°é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œä¹Ÿä¸èƒ½è¢«é‡å¤æ·»åŠ ã€‚    </p>
</li>
<li><p>å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªä»»åŠ¡å‘é€<code>cancel</code>æ¶ˆæ¯æ—¶ï¼Œå±æ€§isCancelledä¼šå˜ä¸ºYESã€‚    ä¸è¿‡ï¼Œå¯¹äºè‡ªå®šä¹‰çš„NSOperationæ¥è¯´ï¼Œè¦æ ¼å¤–æ³¨æ„äº›ã€‚</p>
<p>  åœ¨å‘é€cancelæ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœä»»åŠ¡è¿˜æœªå¼€å§‹æ‰§è¡Œ(isExecuting == NO)ï¼Œå°±ä¼šè¢« finished å¹¶ ä»é˜Ÿåˆ—ä¸­ remove ã€‚</p>
<p>  å¦‚æœä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œè¿™æ—¶å€™ä»»åŠ¡ä¸ä¼šè¢«å¼ºåˆ¶ç»“æŸã€‚æ‰€ä»¥è¿™æ—¶å€™ï¼Œæˆ‘ä»¬è¦åœ¨mainæ–¹æ³•ä¸­ï¼Œæ‰‹åŠ¨æ£€æµ‹(isCancelled == YES)å¹¶å¤„ç†ã€‚        </p>
</li>
<li>isFinishedç­‰äºYESï¼Œä¸ä»£è¡¨ä»»åŠ¡æˆåŠŸå®Œæˆã€‚ä¹Ÿå¯èƒ½ä»»åŠ¡è¢«å–æ¶ˆã€‚æ‰€ä»¥æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨Completion blockå›è°ƒä¸­ï¼Œéœ€è¦åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆã€‚</li>
</ul>
<hr>
<h4 id="NSOperationQueue"><a href="#NSOperationQueue" class="headerlink" title="NSOperationQueue"></a>NSOperationQueue</h4><p>æˆ‘ä»¬æœ‰ä¸¤ç§ä¸åŒçš„é˜Ÿåˆ—ï¼Œä¸»é˜Ÿåˆ—å’Œè‡ªå®šä¹‰é˜Ÿåˆ—ã€‚ä¸»é˜Ÿåˆ—åœ¨ä¸»çº¿ç¨‹è¿è¡Œï¼Œè‡ªå®šä¹‰ä¼šå¼€å¯å­çº¿ç¨‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">NSOperationQueue *mainQueue = [NSOperationQueue mainQueue];  </span><br><span class="line">NSOperationQueue *queue = [[NSOperationQueue alloc] init];</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨NSOperationQueue    çš„æ—¶å€™ï¼Œç³»ç»Ÿé»˜è®¤ä¼šæ ¹æ®å½“å‰èµ„æºä½¿ç”¨çš„æƒ…å†µï¼Œæ¥ä¸ºæˆ‘ä»¬è€ƒè™‘æœ€åˆé€‚çš„çº¿ç¨‹æ•°ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®<code>maxConcurrentOperationCount</code>ï¼Œé™åˆ¶ä½¿ç”¨çš„æœ€å¤§çš„çº¿ç¨‹æ•°ã€‚æ›´å¤šçš„æ—¶å€™ï¼Œå…¶å®æˆ‘ä»¬ä¸å…³å¿ƒï¼Œäº¤ç»™ç³»ç»Ÿå¤„ç†å°±å¥½ã€‚        </p>
<ul>
<li><p>nameï¼šä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨é˜Ÿåˆ—çš„æ—¶å€™ï¼Œéƒ½è¦ç»™ä¸€ä¸ªé˜Ÿåˆ—åå­—ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç»´æŠ¤debugã€‚</p>
</li>
<li><p>suspendedï¼šç”¨æ¥æš‚åœå’Œæ¢å¤é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡ã€‚ä¸èƒ½å•ç‹¬é’ˆå¯¹é˜Ÿåˆ—ä¸­çš„æŸä¸€ä¸ªä»»åŠ¡ã€‚</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// Suspend</span><br><span class="line">[myOperationQueue setSuspended:YES];</span><br><span class="line">... </span><br><span class="line">// Resume</span><br><span class="line">[myOperationQueue setSuspended:NO];</span><br></pre></td></tr></table></figure>
<ul>
<li>operationCount (readonly)ï¼šè·å–é˜Ÿåˆ—ä¸­è¿˜å­˜åœ¨çš„æ­£åœ¨æ‰§è¡Œçš„ã€ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ã€‚æ³¨æ„ï¼Œå½“ä»»åŠ¡ä¸€æ—¦finishedï¼Œå°±ä¼šä»é˜Ÿåˆ—ä¸­removeã€‚        </li>
<li>cancelAllOperationsï¼šå¯¹é˜Ÿåˆ—æ‰€æœ‰çš„operationsï¼Œå‘é€<code>cancel</code>æ¶ˆæ¯ï¼Œå°† isCancelled å±æ€§è®¾ç½®ä¸º YES ã€‚å¦‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºè¿‡çš„ï¼Œå½“operation çš„ isExecuting çŠ¶æ€ä¸º NO æ—¶ï¼Œoperation ä¼šè¢« finished å¹¶ä»é˜Ÿåˆ—ä¸­ remove ã€‚å¦‚æœ isExecuting çŠ¶æ€ä¸º YES ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªå®šä¹‰çš„operationï¼Œå°±è¦æ‰‹åŠ¨æ£€æµ‹ isCancelled å±æ€§ã€‚</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/thumbnail.JPG" alt="Huan Liu">
            
              <p class="site-author-name" itemprop="name">Huan Liu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/MrBoog" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:iosboog@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/2007403/boog" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/boogaloo.l" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2013 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huan Liu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://disqus_3DtNmleMoQ.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
